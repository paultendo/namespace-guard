<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>namespace-guard - Slug Claimability Guard</title>
  <meta name="description" content="Interactive playground for namespace-guard. Check slug availability, reserved names, Unicode spoofing risk, and practical CLI setup for production checks.">
  <meta property="og:title" content="namespace-guard Playground">
  <meta property="og:description" content="Try the slug claimability playground in your browser. Includes Unicode spoofing checks and simple CLI workflows for production policies.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://paultendo.github.io/namespace-guard/">
  <meta property="og:image" content="https://paultendo.github.io/namespace-guard/og.svg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="namespace-guard Playground">
  <meta name="twitter:description" content="Try the slug claimability playground in your browser. Includes Unicode spoofing checks and simple CLI workflows for production policies.">
  <meta name="twitter:image" content="https://paultendo.github.io/namespace-guard/og.svg">
  <meta name="theme-color" content="#090e17">
  <link rel="canonical" href="https://paultendo.github.io/namespace-guard/">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x1f6e1;</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=Google+Sans+Code:wght@400;500&family=Instrument+Sans:wght@400;500;600;700&family=Syne:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --background: #090e17;
      --foreground: #eef4ff;
      --ink-muted: #bcc9df;
      --accent: #1ed760;
      --accent-strong: #11bf4f;
      --accent-soft: rgba(30, 215, 96, 0.22);
      --line: rgba(208, 227, 255, 0.15);
      --red: #ff5a5a;
      --red-soft: rgba(255, 90, 90, 0.12);
      --amber: #ffbe3c;
      --amber-soft: rgba(255, 190, 60, 0.12);
      --syntax-kw: #c792ea;
      --syntax-fn: #82aaff;
      --syntax-str: #c3e88d;
      --syntax-cm: #546e7a;
      --syntax-type: #ffcb6b;
      --syntax-var: #f78c6c;
      --syntax-br: rgba(255,255,255,0.3);
      --font-display: 'Syne', system-ui, sans-serif;
      --font-body: 'Instrument Sans', system-ui, sans-serif;
      --font-mono: 'Google Sans Code', ui-monospace, 'SF Mono', monospace;
      --font-serif: 'Fraunces', Georgia, serif;
      --shell-pad: clamp(1rem, 2.2vw, 2.25rem);
    }

    html { background: #080b12; }

    body {
      background:
        radial-gradient(1300px 720px at 9% -8%, rgba(30, 215, 96, 0.22), transparent 48%),
        radial-gradient(980px 640px at 88% 2%, rgba(63, 121, 255, 0.2), transparent 52%),
        radial-gradient(1020px 760px at 50% 108%, rgba(15, 30, 58, 0.62), transparent 56%),
        linear-gradient(180deg, #0c1018 0%, #080b12 100%);
      color: var(--foreground);
      font-family: var(--font-body);
      letter-spacing: 0.01em;
      line-height: 1.6;
      min-height: 100vh;
    }

    ::selection {
      background: rgba(30, 215, 96, 0.34);
      color: #fff;
    }

    /* Skip link */
    .skip-link {
      position: fixed; left: 1rem; top: 0.75rem; z-index: 120;
      border: 1px solid rgba(30, 215, 96, 0.52);
      border-radius: 0.6rem;
      padding: 0.45rem 0.8rem;
      font-size: 0.75rem; font-weight: 600;
      color: #e7fff1;
      background: rgba(6, 18, 12, 0.94);
      box-shadow: 0 10px 24px -14px rgba(0,0,0,0.88), inset 0 1px 0 rgba(255,255,255,0.14);
      transform: translateY(-180%); opacity: 0;
      transition: transform 180ms cubic-bezier(0.22,1,0.36,1), opacity 180ms ease;
      text-decoration: none;
    }
    .skip-link:focus-visible { transform: translateY(0); opacity: 1; }

    /* Layout */
    .shell {
      width: min(100%, 72rem);
      margin-inline: auto;
      padding-inline: var(--shell-pad);
    }

    /* Focus ring */
    :focus-visible {
      outline: 2px solid var(--accent-soft);
      outline-offset: 2px;
    }

    /* Typography */
    .display-type {
      font-family: var(--font-display);
      letter-spacing: -0.02em;
    }
    .phonetic-serif {
      font-family: var(--font-serif);
      font-variation-settings: "SOFT" 40, "WONK" 0;
    }
    .mono { font-family: var(--font-mono); }

    /* Hero */
    .hero {
      padding-top: clamp(3rem, 8vh, 6rem);
      padding-bottom: clamp(2rem, 5vh, 4rem);
      text-align: center;
    }
    .hero h1 {
      font-size: clamp(2.2rem, 5vw, 3.8rem);
      font-weight: 800;
      line-height: 1.1;
      margin-bottom: 1rem;
    }
    .hero-tagline {
      font-size: clamp(1rem, 1.8vw, 1.25rem);
      color: var(--ink-muted);
      max-width: 42ch;
      margin: 0 auto 1.5rem;
    }
    .hero-phonetic {
      font-size: 0.95rem;
      color: var(--ink-muted);
      margin-bottom: 2rem;
    }
    .hero-phonetic .pron { font-style: italic; color: var(--foreground); opacity: 0.7; }
    .hero-phonetic .pos { font-style: italic; opacity: 0.6; margin-left: 0.5em; }
    .hero-phonetic .def { display: block; margin-top: 0.3rem; max-width: 48ch; margin-inline: auto; }
    .hero-actions { display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap; }

    /* Buttons */
    .btn-primary {
      display: inline-flex; align-items: center; justify-content: center;
      border-radius: 1rem; padding: 0.6rem 1.4rem;
      font-size: 0.9rem; font-weight: 600; font-family: var(--font-body);
      color: #04120a; text-decoration: none; border: none; cursor: pointer;
      background: linear-gradient(135deg, var(--accent) 0%, #4bf07e 100%);
      box-shadow: 0 10px 26px -10px rgba(30,215,96,0.62), inset 0 1px 0 rgba(255,255,255,0.55);
      transition: filter 0.15s, box-shadow 0.15s, transform 0.1s;
    }
    .btn-primary:hover {
      filter: brightness(1.04);
      box-shadow: 0 14px 32px -12px rgba(30,215,96,0.72), inset 0 1px 0 rgba(255,255,255,0.68);
    }
    .btn-primary:active { transform: scale(0.98); }

    .btn-secondary {
      display: inline-flex; align-items: center; justify-content: center;
      border-radius: 1rem; padding: 0.6rem 1.4rem;
      font-size: 0.9rem; font-weight: 600; font-family: var(--font-body);
      text-decoration: none; cursor: pointer;
      border: 1px solid rgba(203,222,255,0.22);
      color: #d8e2f3;
      background: rgba(11,18,29,0.52);
      transition: color 0.15s, border-color 0.15s, background 0.15s;
    }
    .btn-secondary:hover {
      color: #fff;
      border-color: rgba(203,222,255,0.34);
      background: rgba(17,27,43,0.68);
    }

    /* Divider */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(196,216,248,0.36), rgba(30,215,96,0.34), transparent);
      margin: clamp(2rem, 4vh, 3.5rem) 0;
    }

    /* Cards */
    .glass-card {
      border: 1px solid rgba(212,230,255,0.16);
      background: linear-gradient(145deg, rgba(20,29,44,0.84), rgba(9,14,23,0.62));
      border-radius: 1.15rem;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 8px 34px -20px rgba(3,8,16,0.82);
      backdrop-filter: blur(12px) saturate(130%);
      -webkit-backdrop-filter: blur(12px) saturate(130%);
      padding: clamp(1.25rem, 2vw, 2rem);
    }

    /* How it works */
    .how-section { text-align: center; }
    .how-section h2 {
      font-size: clamp(1.3rem, 2.5vw, 1.8rem);
      font-weight: 700;
      margin-bottom: 1.5rem;
    }
    .how-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: 1fr;
    }
    @media (min-width: 640px) {
      .how-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .how-grid > .how-card:last-child:nth-child(odd) {
        grid-column: 1 / -1;
        justify-self: center;
        width: min(38rem, 100%);
      }
    }
    @media (min-width: 1024px) {
      .how-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .how-grid > .how-card:last-child:nth-child(odd) {
        grid-column: auto;
        justify-self: stretch;
        width: auto;
      }
    }
    .how-card { text-align: left; }
    .how-card h3 {
      font-size: 1rem; font-weight: 600;
      margin-bottom: 0.4rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .how-card p { font-size: 0.88rem; color: var(--ink-muted); }
    .how-card .example {
      margin-top: 0.6rem;
      font-family: var(--font-mono);
      font-size: 0.82rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0,0,0,0.3);
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.06);
    }
    .how-card .example .val { color: var(--accent); }
    .how-card .example .err { color: var(--red); }
    .how-card .example .warn { color: var(--amber); }
    .profiles-cards {
      display: grid;
      gap: 1rem;
      grid-template-columns: 1fr;
      text-align: left;
    }
    @media (min-width: 900px) {
      .profiles-cards { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    .checklist {
      margin-top: 0.55rem;
      padding-left: 1.05rem;
      display: grid;
      gap: 0.35rem;
      color: var(--ink-muted);
      font-size: 0.83rem;
      line-height: 1.45;
    }
    .checklist li::marker { color: rgba(188,201,223,0.7); }
    .insight-card .label {
      display: inline-block;
      margin-top: 0.55rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: rgba(188,201,223,0.62);
    }
    .profile-override {
      margin-top: 1rem;
      text-align: left;
    }

    /* Playground */
    .playground { text-align: left; }
    .playground h2 {
      font-size: clamp(1.3rem, 2.5vw, 1.8rem);
      font-weight: 700;
      margin-bottom: 1.25rem;
    }
    .playground-card { padding: clamp(1.5rem, 3vw, 2.5rem); }

    .input-group {
      display: flex;
      align-items: center;
      gap: 0;
      background: rgba(0,0,0,0.35);
      border: 1px solid var(--line);
      border-radius: 0.75rem;
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .input-group:focus-within {
      border-color: rgba(30,215,96,0.55);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }
    .input-prefix {
      padding: 0.7rem 0 0.7rem 1rem;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--ink-muted);
      white-space: nowrap;
      user-select: none;
      flex-shrink: 0;
    }
    .input-field {
      flex: 1;
      min-width: 0;
      padding: 0.7rem 0.5rem;
      background: transparent;
      border: none;
      color: var(--foreground);
      font-family: var(--font-mono);
      font-size: 0.9rem;
      outline: none;
    }
    .input-field::placeholder { color: rgba(188,201,223,0.4); }
    .check-btn {
      flex-shrink: 0;
      margin: 0.35rem 0.35rem 0.35rem 0;
      padding: 0.45rem 1.1rem;
      border-radius: 0.5rem;
      font-size: 0.85rem;
    }

    /* Result area */
    .result-area {
      min-height: 3.5rem;
      margin-top: 1rem;
    }
    .result-card {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.85rem 1rem;
      border-radius: 0.7rem;
      border: 1px solid transparent;
      animation: resultIn 0.2s ease;
    }
    @keyframes resultIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (prefers-reduced-motion: reduce) {
      @keyframes resultIn { from { opacity: 1; transform: none; } }
      .skip-link { transition: none; }
      details[open] .mock-summary .chevron { transition: none; }
    }
    .result-available {
      background: rgba(30,215,96,0.08);
      border-color: rgba(30,215,96,0.25);
    }
    .result-invalid, .result-taken {
      background: var(--red-soft);
      border-color: rgba(255,90,90,0.25);
    }
    .result-reserved {
      background: var(--amber-soft);
      border-color: rgba(255,190,60,0.25);
    }
    .result-riskwarn {
      background: var(--amber-soft);
      border-color: rgba(255,190,60,0.35);
    }
    .result-riskblock {
      background: rgba(255,90,90,0.16);
      border-color: rgba(255,90,90,0.35);
    }
    .result-icon { flex-shrink: 0; width: 1.25rem; height: 1.25rem; margin-top: 0.1rem; }
    .result-body { flex: 1; min-width: 0; }
    .result-body strong { font-weight: 600; }
    .result-body .slug-name { font-family: var(--font-mono); }
    .result-body .result-msg { font-size: 0.88rem; color: var(--ink-muted); margin-top: 0.15rem; }
    .result-body .result-source {
      display: inline-block;
      font-size: 0.75rem; font-family: var(--font-mono);
      padding: 0.1rem 0.45rem;
      border-radius: 0.3rem;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      margin-left: 0.4rem;
      vertical-align: middle;
    }
    .result-body .result-category {
      display: inline-block;
      font-size: 0.75rem; font-family: var(--font-mono);
      padding: 0.1rem 0.45rem;
      border-radius: 0.3rem;
      background: rgba(255,190,60,0.12);
      border: 1px solid rgba(255,190,60,0.2);
      color: var(--amber);
      margin-left: 0.4rem;
      vertical-align: middle;
    }

    /* Suggestions */
    .suggestions { margin-top: 0.6rem; }
    .suggestions-label { font-size: 0.82rem; color: var(--ink-muted); margin-bottom: 0.35rem; }
    .suggestion-pills { display: flex; flex-wrap: wrap; gap: 0.4rem; }
    .suggestion-pill {
      font-family: var(--font-mono);
      font-size: 0.82rem;
      padding: 0.25rem 0.65rem;
      border-radius: 2rem;
      border: 1px solid rgba(30,215,96,0.3);
      background: rgba(30,215,96,0.08);
      color: var(--accent);
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
    }
    .suggestion-pill:hover {
      background: rgba(30,215,96,0.18);
      border-color: rgba(30,215,96,0.5);
    }

    /* Strategy selector */
    .strategy-section { margin-top: 1rem; }
    .strategy-label {
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--ink-muted);
      margin-bottom: 0.4rem;
    }
    .strategy-row { display: flex; flex-wrap: wrap; gap: 0.35rem; }
    .strategy-chip {
      font-family: var(--font-mono);
      font-size: 0.78rem;
      padding: 0.25rem 0.65rem;
      border-radius: 2rem;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--ink-muted);
      cursor: pointer;
      transition: color 0.15s, border-color 0.15s, background 0.15s;
    }
    .strategy-chip:hover {
      color: var(--foreground);
      border-color: rgba(208,227,255,0.3);
      background: rgba(255,255,255,0.06);
    }
    .strategy-chip[aria-pressed="true"] {
      color: var(--accent);
      border-color: rgba(30,215,96,0.4);
      background: rgba(30,215,96,0.1);
    }
    .playground-policy {
      margin-top: 0.8rem;
      font-size: 0.8rem;
      color: rgba(188,201,223,0.74);
      line-height: 1.45;
    }
    .playground-depth {
      margin-top: 0.3rem;
      font-size: 0.76rem;
      color: rgba(188,201,223,0.58);
      line-height: 1.35;
    }

    /* Examples */
    .examples-section { margin-top: 1.5rem; }
    .examples-label {
      font-size: 0.82rem;
      color: var(--ink-muted);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    .examples-row { display: flex; flex-wrap: wrap; gap: 0.4rem; }
    .example-pill {
      font-family: var(--font-mono);
      font-size: 0.82rem;
      padding: 0.3rem 0.7rem;
      border-radius: 2rem;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--ink-muted);
      cursor: pointer;
      transition: color 0.15s, border-color 0.15s, background 0.15s;
    }
    .example-pill:hover {
      color: var(--foreground);
      border-color: rgba(208,227,255,0.3);
      background: rgba(255,255,255,0.06);
    }

    /* Mock data */
    .mock-section { margin-top: 1.5rem; }
    .mock-summary {
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--ink-muted);
      cursor: pointer;
      user-select: none;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .mock-summary::-webkit-details-marker { display: none; }
    .mock-summary .chevron {
      transition: transform 0.2s;
      width: 0.8rem; height: 0.8rem;
    }
    details[open] .mock-summary .chevron { transform: rotate(90deg); }
    .mock-grid {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: 1fr;
      margin-top: 0.75rem;
      font-size: 0.82rem;
    }
    @media (min-width: 640px) {
      .mock-grid { grid-template-columns: 1fr 1fr; }
    }
    .mock-group h4 {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--ink-muted);
      margin-bottom: 0.3rem;
    }
    .mock-group .tags { display: flex; flex-wrap: wrap; gap: 0.3rem; }
    .mock-tag {
      font-family: var(--font-mono);
      font-size: 0.78rem;
      padding: 0.15rem 0.5rem;
      border-radius: 0.3rem;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
    }

    /* Code section */
    .code-section { text-align: left; }
    .code-section h2 {
      font-size: clamp(1.3rem, 2.5vw, 1.8rem);
      font-weight: 700;
      margin-bottom: 1.25rem;
    }
    .adapter-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      padding: 0.35rem;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.08);
      border-bottom: none;
      border-radius: 0.75rem 0.75rem 0 0;
    }
    .adapter-tab {
      padding: 0.4rem 0.85rem;
      border-radius: 0.5rem;
      border: 1px solid transparent;
      background: transparent;
      color: var(--ink-muted);
      font-family: var(--font-body);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: color 0.15s, background 0.15s, border-color 0.15s;
      white-space: nowrap;
    }
    .adapter-tab:hover {
      color: var(--foreground);
      background: rgba(255,255,255,0.04);
    }
    .adapter-tab[aria-selected="true"] {
      color: var(--foreground);
      background: rgba(255,255,255,0.08);
      border-color: rgba(255,255,255,0.12);
    }
    .adapter-panel { display: none; }
    .adapter-panel.active { display: block; }
    .code-block {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 0 0 0.75rem 0.75rem;
      padding: 1.25rem 1.5rem;
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      line-height: 1.7;
      color: var(--ink-muted);
      white-space: pre;
    }
    .code-block code { font: inherit; color: inherit; }
    .code-block .kw,
    .insight-card .example .kw { color: var(--syntax-kw); }
    .code-block .fn,
    .insight-card .example .fn { color: var(--syntax-fn); }
    .code-block .str,
    .insight-card .example .str { color: var(--syntax-str); }
    .code-block .cm,
    .insight-card .example .cm { color: var(--syntax-cm); font-style: italic; }
    .code-block .type,
    .insight-card .example .type { color: var(--syntax-type); }
    .code-block .br,
    .insight-card .example .br { color: var(--syntax-br); }
    .code-block .var,
    .insight-card .example .var { color: var(--syntax-var); }

    /* Pipeline explainer */
    .pipeline-section { text-align: center; }
    .pipeline-section h2 {
      font-size: clamp(1.3rem, 2.5vw, 1.8rem);
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    .pipeline-section .subtitle {
      color: var(--ink-muted);
      font-size: 0.92rem;
      margin-bottom: 1.5rem;
    }
    .pipeline-flow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.75rem;
    }
    .pipeline-stage {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
      padding: 0.75rem 1rem;
      background: rgba(0,0,0,0.35);
      border: 1px solid var(--line);
      border-radius: 0.65rem;
      min-width: 8rem;
    }
    .pipeline-stage .stage-num {
      font-family: var(--font-mono);
      font-size: 0.72rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .pipeline-stage .stage-name {
      font-weight: 600;
      font-size: 0.88rem;
    }
    .pipeline-stage .stage-desc {
      font-size: 0.78rem;
      color: var(--ink-muted);
    }
    .pipeline-arrow {
      color: rgba(188,201,223,0.3);
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    .insight-cards {
      display: grid;
      gap: 1rem;
      grid-template-columns: 1fr;
      text-align: left;
    }
    @media (min-width: 768px) {
      .insight-cards { grid-template-columns: 1fr 1fr; }
    }
    .insight-card {
      padding: clamp(1rem, 2vw, 1.5rem);
    }
    .insight-card h3 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .insight-card p {
      font-size: 0.85rem;
      color: var(--ink-muted);
      line-height: 1.55;
    }
    .insight-card .example {
      margin-top: 0.6rem;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0,0,0,0.3);
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.06);
      line-height: 1.6;
    }
    .insight-card .example .val { color: var(--accent); }
    .insight-card .example .err { color: var(--red); }
    .insight-card .example .dim { color: rgba(188,201,223,0.4); }
    .inline-chip {
      font-size: 0.8rem;
      background: rgba(0,0,0,0.3);
      padding: 0.1rem 0.35rem;
      border-radius: 0.25rem;
    }

    /* Confusable highlight in result */
    .confusable-detail {
      margin-top: 0.5rem;
      font-family: var(--font-mono);
      font-size: 0.82rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0,0,0,0.25);
      border-radius: 0.4rem;
      border: 1px solid rgba(255,90,90,0.15);
      line-height: 1.6;
    }
    .confusable-detail .char-highlight {
      color: var(--red);
      font-weight: 600;
      text-decoration: underline;
      text-decoration-color: rgba(255,90,90,0.5);
      text-underline-offset: 2px;
    }
    .confusable-detail .char-latin {
      color: var(--accent);
      font-weight: 600;
    }
    .confusable-detail .char-meta {
      color: var(--ink-muted);
      font-size: 0.78rem;
    }
    .slug-annotated .spoof-char {
      color: var(--red);
      text-decoration: underline wavy rgba(255,90,90,0.7);
      text-underline-offset: 3px;
    }

    /* Footer */
    footer {
      margin-top: clamp(2.5rem, 5vh, 4rem);
      padding-bottom: clamp(2rem, 4vh, 3rem);
      text-align: center;
    }
    .install-bar {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(0,0,0,0.35);
      border: 1px solid var(--line);
      border-radius: 0.7rem;
      padding: 0.6rem 0.8rem 0.6rem 1.2rem;
      font-family: var(--font-mono);
      font-size: 0.88rem;
      margin-bottom: 1.25rem;
    }
    .install-bar code { color: var(--ink-muted); }
    .install-bar .prefix { color: var(--accent); user-select: none; }
    .copy-btn {
      padding: 0.3rem 0.6rem;
      border-radius: 0.4rem;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--ink-muted);
      font-size: 0.78rem;
      cursor: pointer;
      transition: color 0.15s, border-color 0.15s;
      font-family: var(--font-body);
    }
    .copy-btn:hover { color: var(--foreground); border-color: rgba(208,227,255,0.3); }
    .footer-links {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      font-size: 0.85rem;
    }
    .footer-links a {
      color: var(--ink-muted);
      text-decoration: none;
      transition: color 0.15s;
    }
    .footer-links a:hover { color: var(--foreground); }
    .footer-author {
      margin-top: 1rem;
      font-size: 0.8rem;
      color: rgba(188,201,223,0.5);
    }

    /* Utility */
    .sr-only {
      position: absolute; width: 1px; height: 1px;
      padding: 0; margin: -1px; overflow: hidden;
      clip: rect(0,0,0,0); white-space: nowrap; border: 0;
    }
  </style>
</head>
<body>
  <a href="#playground" class="skip-link">Skip to playground</a>

  <header class="shell hero">
    <h1 class="display-type">namespace-guard</h1>
    <p class="hero-tagline">Claim safe slugs in one line: availability, spoofing protection, and moderation hooks.</p>
    <div class="hero-phonetic phonetic-serif">
      <span class="pron">/neym-speys gahrd/</span>
      <span class="pos">noun</span>
      <span class="def">A zero-dependency utility that prevents slug collisions across users, organisations, and reserved routes - with built-in Unicode spoofing protection and pluggable moderation.</span>
    </div>
    <div class="hero-actions">
      <a href="#playground" class="btn-primary">Try it out</a>
      <a href="https://github.com/paultendo/namespace-guard" class="btn-secondary" target="_blank" rel="noopener">View on GitHub</a>
      <a href="https://paultendo.github.io/posts/namespace-guard-launch/" class="btn-secondary" target="_blank" rel="noopener">Read the blog post</a>
    </div>
  </header>

  <main class="shell">
    <!-- How it works -->
    <section class="how-section" aria-labelledby="how-heading">
      <h2 id="how-heading" class="display-type">How it works</h2>
      <div class="how-grid">
        <div class="glass-card how-card">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            Format Validation
          </h3>
          <p>Validates identifiers against a configurable regex pattern. Default: 2&ndash;30 lowercase alphanumeric characters and hyphens.</p>
          <div class="example"><span class="err">"a"</span> &rarr; invalid</div>
        </div>
        <div class="glass-card how-card">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            Reserved Names
          </h3>
          <p>Blocks system routes, brand names, and other reserved identifiers. Supports categorised lists with custom error messages.</p>
          <div class="example"><span class="warn">"admin"</span> &rarr; reserved <small>(system)</small></div>
        </div>
        <div class="glass-card how-card">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
            Collision Detection
          </h3>
          <p>Checks multiple database tables in parallel. Users, organisations, teams - one call covers them all, with alternative suggestions.</p>
          <div class="example"><span class="err">"sarah"</span> &rarr; taken by <small>user</small></div>
        </div>
        <div class="glass-card how-card">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            Anti-Spoofing
          </h3>
          <p>Detects visually deceptive Unicode characters from 20+ scripts using a 613-pair confusable map generated from Unicode TR39.</p>
          <div class="example"><span class="err">"&#x430;dmin"</span> &rarr; Cyrillic "&#x430;" looks like "a"</div>
        </div>
        <div class="glass-card how-card">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            Profanity &amp; Evasion
          </h3>
          <p>Blocks common profanity obfuscation (Unicode confusables + substitutions) with conservative defaults, and supports external moderation libraries via validators.</p>
          <div class="example"><span class="err">"5h1t"</span> &rarr; blocked</div>
        </div>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- Profiles -->
    <section class="pipeline-section" aria-labelledby="profiles-heading">
      <h2 id="profiles-heading" class="display-type">Built-in Profiles</h2>
      <p class="subtitle">Start with a profile that matches your namespace type, then customize as needed.</p>

      <div class="profiles-cards">
        <div class="glass-card insight-card">
          <h3>consumer-handle</h3>
          <p>For public usernames and handles. Strict anti-impersonation defaults.</p>
          <ul class="checklist">
            <li>2-30 chars</li>
            <li>lowercase letters, numbers, hyphens</li>
            <li>purely numeric names blocked</li>
          </ul>
          <span class="label">Best for: social/community handles</span>
        </div>
        <div class="glass-card insight-card">
          <h3>org-slug</h3>
          <p>For teams, workspaces, and company slugs. Slightly longer and conservative by default.</p>
          <ul class="checklist">
            <li>2-40 chars</li>
            <li>lowercase letters, numbers, hyphens</li>
            <li>purely numeric names blocked</li>
          </ul>
          <span class="label">Best for: org/workspace URLs</span>
        </div>
        <div class="glass-card insight-card">
          <h3>developer-id</h3>
          <p>For technical IDs and package-style names. Allows more length and numeric-only IDs.</p>
          <ul class="checklist">
            <li>2-50 chars</li>
            <li>lowercase letters, numbers, hyphens</li>
            <li>purely numeric names allowed</li>
          </ul>
          <span class="label">Best for: internal/dev tooling identifiers</span>
        </div>
      </div>
      <div class="glass-card insight-card profile-override">
        <h3>Start with a profile, override what you need</h3>
        <p>Profiles are defaults, not lock-in. Most setups only need one or two overrides.</p>
        <div class="example">
          <span class="kw">const</span> guard = <span class="fn">createNamespaceGuardWithProfile</span><span class="br">(</span><span class="str">"org-slug"</span>, <span class="br">{</span><br>
          &nbsp;&nbsp;<span class="var">allowPurelyNumeric</span>: <span class="kw">true</span>,<br>
          <span class="br">}</span>, adapter<span class="br">)</span>;
        </div>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- Scope -->
    <section class="pipeline-section" aria-labelledby="scope-heading">
      <h2 id="scope-heading" class="display-type">What It Does (And Doesn&rsquo;t)</h2>
      <p class="subtitle">Plain boundaries so teams know exactly where this library helps.</p>

      <div class="insight-cards">
        <div class="glass-card insight-card">
          <h3>What it does</h3>
          <ul class="checklist">
            <li>Normalizes and validates slug format</li>
            <li>Checks collisions across multiple data sources</li>
            <li>Blocks reserved names</li>
            <li>Scores and enforces Unicode confusable risk</li>
            <li>Lets you plug in moderation or policy validators</li>
          </ul>
        </div>
        <div class="glass-card insight-card">
          <h3>What it doesn&rsquo;t do</h3>
          <ul class="checklist">
            <li>It does not bundle third-party moderation datasets</li>
            <li>It does not replace account security controls (2FA, verification, abuse ops)</li>
            <li>It does not guarantee perfect abuse detection</li>
            <li>This playground uses simulated data, not your live database</li>
          </ul>
        </div>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- Playground -->
    <section id="playground" class="playground" aria-labelledby="playground-heading">
      <h2 id="playground-heading" class="display-type">Try it out</h2>
      <div class="glass-card playground-card">
        <form id="check-form" role="search" aria-label="Check slug claimability">
          <div class="input-group">
            <span class="input-prefix" aria-hidden="true">yourapp.com/</span>
            <input
              id="slug-input"
              class="input-field"
              type="text"
              placeholder="pick-a-slug"
              autocomplete="off"
              spellcheck="false"
              aria-describedby="playground-desc"
              aria-label="Slug to check"
              autofocus
            >
            <button type="submit" class="btn-primary check-btn">Claim check</button>
          </div>
        </form>
        <p id="playground-desc" class="sr-only">Type a slug to run claimability checks against simulated data, including reserved names, collisions, spoofing risk, and optional profanity evasion checks.</p>

        <div class="strategy-section">
          <div class="strategy-label">Policy profile:</div>
          <div class="strategy-row" role="group" aria-label="Choose namespace profile">
            <button class="strategy-chip" aria-pressed="true" data-profile="consumer-handle">consumer-handle</button>
            <button class="strategy-chip" aria-pressed="false" data-profile="org-slug">org-slug</button>
            <button class="strategy-chip" aria-pressed="false" data-profile="developer-id">developer-id</button>
          </div>
        </div>

        <div class="strategy-section">
          <div class="strategy-label">Suggestion strategy:</div>
          <div class="strategy-row" role="group" aria-label="Choose suggestion strategy">
            <button class="strategy-chip" aria-pressed="true" data-strategy="sequential,random-digits">default</button>
            <button class="strategy-chip" aria-pressed="false" data-strategy="sequential">sequential</button>
            <button class="strategy-chip" aria-pressed="false" data-strategy="random-digits">random-digits</button>
            <button class="strategy-chip" aria-pressed="false" data-strategy="suffix-words">suffix-words</button>
            <button class="strategy-chip" aria-pressed="false" data-strategy="short-random">short-random</button>
            <button class="strategy-chip" aria-pressed="false" data-strategy="scramble">scramble</button>
            <button class="strategy-chip" aria-pressed="false" data-strategy="similar">similar</button>
          </div>
        </div>

        <div class="strategy-section">
          <div class="strategy-label">Security options:</div>
          <div class="strategy-row" role="group" aria-label="Toggle security features">
            <button class="strategy-chip" aria-pressed="true" id="toggle-homoglyph">confusable chars</button>
            <button class="strategy-chip" aria-pressed="true" id="toggle-mixed-script">mixed-script block</button>
            <button class="strategy-chip" aria-pressed="true" id="toggle-profanity">profanity evasion</button>
            <button class="strategy-chip" aria-pressed="true" id="toggle-numeric">reject purely numeric</button>
            <button class="strategy-chip" aria-pressed="false" id="toggle-fail-warn">fail on warn</button>
          </div>
          <p id="playground-policy" class="playground-policy"></p>
          <p id="playground-depth" class="playground-depth"></p>
        </div>

        <div id="result" class="result-area" aria-live="polite" aria-atomic="true"></div>

        <div class="examples-section">
          <div class="examples-label">Try these:</div>
          <div class="examples-row" role="group" aria-label="Example slugs to try">
            <button class="example-pill" data-slug="sarah">sarah</button>
            <button class="example-pill" data-slug="admin">admin</button>
            <button class="example-pill" data-slug="shit">blocked-word</button>
            <button class="example-pill" data-slug="sh1t">obfuscated-word-1</button>
            <button class="example-pill" data-slug="5h1t">obfuscated-word-2</button>
            <button class="example-pill" data-slug="acme-corp">acme-corp</button>
            <button class="example-pill" data-slug="my-new-app">my-new-app</button>
            <button class="example-pill" data-slug="paypa1">paypa1</button>
            <button class="example-pill" data-slug="a">a</button>
            <button class="example-pill" data-slug="hello!">hello!</button>
            <button class="example-pill" data-slug="@Bob">@Bob</button>
            <button class="example-pill" data-slug="namespace-guard">namespace-guard</button>
            <button class="example-pill" data-slug="&#x430;dmin" title="Cyrillic а + Latin dmin">\u0430dmin</button>
            <button class="example-pill" data-slug="&#x570;ello" title="Armenian հ + Latin ello">&#x570;ello</button>
            <button class="example-pill" data-slug="&#x13AA;dmin" title="Cherokee Ꭺ + Latin dmin">&#x13AA;dmin</button>
            <button class="example-pill" data-slug="&#x251;dmin" title="IPA ɑ + Latin dmin">&#x251;dmin</button>
            <button class="example-pill" data-slug="&#x1D00;dmin" title="Latin small cap ᴀ + Latin dmin">&#x1D00;dmin</button>
            <button class="example-pill" data-slug="&#xFF48;&#xFF45;&#xFF4C;&#xFF4C;&#xFF4F;" title="Full-width NFKC test">ｈｅｌｌｏ</button>
            <button class="example-pill" data-slug="123456">123456</button>
          </div>
        </div>

        <div class="mock-section">
          <details>
            <summary class="mock-summary">
              <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
              Simulated database
            </summary>
            <div class="mock-grid">
              <div class="mock-group">
                <h4>Users</h4>
                <div class="tags">
                  <span class="mock-tag">sarah</span>
                  <span class="mock-tag">bob</span>
                  <span class="mock-tag">charlie</span>
                </div>
              </div>
              <div class="mock-group">
                <h4>Organisations</h4>
                <div class="tags">
                  <span class="mock-tag">acme-corp</span>
                  <span class="mock-tag">github</span>
                  <span class="mock-tag">vercel</span>
                </div>
              </div>
              <div class="mock-group">
                <h4>Reserved (system)</h4>
                <div class="tags">
                  <span class="mock-tag">admin</span>
                  <span class="mock-tag">api</span>
                  <span class="mock-tag">settings</span>
                  <span class="mock-tag">dashboard</span>
                  <span class="mock-tag">login</span>
                  <span class="mock-tag">signup</span>
                  <span class="mock-tag">help</span>
                  <span class="mock-tag">support</span>
                  <span class="mock-tag">billing</span>
                </div>
              </div>
              <div class="mock-group">
                <h4>Reserved (brand)</h4>
                <div class="tags">
                  <span class="mock-tag">namespace-guard</span>
                </div>
              </div>
              <div class="mock-group">
                <h4>Moderation list (demo)</h4>
                <div class="tags">
                  <span class="mock-tag">English list (~2.7k terms)</span>
                  <span class="mock-tag">Custom additions included</span>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- Code example -->
    <section class="code-section" aria-labelledby="code-heading">
      <h2 id="code-heading" class="display-type">Use it in your project</h2>
      <div role="tablist" class="adapter-tabs" aria-label="Choose your database adapter">
        <button role="tab" class="adapter-tab" aria-selected="true" aria-controls="panel-prisma" id="tab-prisma">Prisma</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-drizzle" id="tab-drizzle">Drizzle</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-kysely" id="tab-kysely">Kysely</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-knex" id="tab-knex">Knex</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-typeorm" id="tab-typeorm">TypeORM</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-mikroorm" id="tab-mikroorm">MikroORM</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-sequelize" id="tab-sequelize">Sequelize</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-mongoose" id="tab-mongoose">Mongoose</button>
        <button role="tab" class="adapter-tab" aria-selected="false" aria-controls="panel-raw" id="tab-raw">Raw SQL</button>
      </div>
      <div id="panel-prisma" role="tabpanel" aria-labelledby="tab-prisma" class="adapter-panel active">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuardWithProfile</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createPrismaAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/prisma"</span>;
<span class="kw">import</span> <span class="br">{</span> PrismaClient <span class="br">}</span> <span class="kw">from</span> <span class="str">"@prisma/client"</span>;

<span class="kw">const</span> prisma = <span class="kw">new</span> <span class="fn">PrismaClient</span><span class="br">()</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuardWithProfile</span><span class="br">(</span><span class="str">"consumer-handle"</span>, <span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"user"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organization"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
<span class="br">}</span>, <span class="fn">createPrismaAdapter</span><span class="br">(</span>prisma<span class="br">)</span><span class="br">)</span>;

<span class="kw">await</span> guard.<span class="fn">assertClaimable</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;
<span class="cm">// throws if invalid, reserved, taken, or too confusable</span></code></pre>
      </div>
      <div id="panel-drizzle" role="tabpanel" aria-labelledby="tab-drizzle" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createDrizzleAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/drizzle"</span>;
<span class="kw">import</span> <span class="br">{</span> eq <span class="br">}</span> <span class="kw">from</span> <span class="str">"drizzle-orm"</span>;
<span class="kw">import</span> <span class="br">{</span> db <span class="br">}</span> <span class="kw">from</span> <span class="str">"./db"</span>;
<span class="kw">import</span> <span class="br">{</span> users, organizations <span class="br">}</span> <span class="kw">from</span> <span class="str">"./schema"</span>;

<span class="kw">const</span> adapter = <span class="fn">createDrizzleAdapter</span><span class="br">(</span>db, <span class="br">{</span> users, organizations <span class="br">}</span>, eq<span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"users"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organizations"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, adapter<span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;

<span class="kw">if</span> <span class="br">(</span>result.available<span class="br">)</span> <span class="br">{</span>
  <span class="cm">// Safe to create</span>
<span class="br">}</span> <span class="kw">else</span> <span class="br">{</span>
  console.<span class="fn">log</span><span class="br">(</span>result.message<span class="br">)</span>;      <span class="cm">// "That name is already in use."</span>
  console.<span class="fn">log</span><span class="br">(</span>result.suggestions<span class="br">)</span>; <span class="cm">// ["acme-corp-1", "acme-corp-4821", "acme-corp1"]</span>
<span class="br">}</span></code></pre>
      </div>
      <div id="panel-kysely" role="tabpanel" aria-labelledby="tab-kysely" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createKyselyAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/kysely"</span>;
<span class="kw">import</span> <span class="br">{</span> Kysely, PostgresDialect <span class="br">}</span> <span class="kw">from</span> <span class="str">"kysely"</span>;

<span class="kw">const</span> db = <span class="kw">new</span> <span class="fn">Kysely</span><span class="br">(</span><span class="br">{</span> dialect: <span class="kw">new</span> <span class="fn">PostgresDialect</span><span class="br">(</span><span class="br">{</span> pool <span class="br">}</span><span class="br">)</span> <span class="br">}</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"users"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organizations"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, <span class="fn">createKyselyAdapter</span><span class="br">(</span>db<span class="br">)</span><span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;

<span class="kw">if</span> <span class="br">(</span>result.available<span class="br">)</span> <span class="br">{</span>
  <span class="cm">// Safe to create</span>
<span class="br">}</span> <span class="kw">else</span> <span class="br">{</span>
  console.<span class="fn">log</span><span class="br">(</span>result.message<span class="br">)</span>;      <span class="cm">// "That name is already in use."</span>
  console.<span class="fn">log</span><span class="br">(</span>result.suggestions<span class="br">)</span>; <span class="cm">// ["acme-corp-1", "acme-corp-4821", "acme-corp1"]</span>
<span class="br">}</span></code></pre>
      </div>
      <div id="panel-knex" role="tabpanel" aria-labelledby="tab-knex" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createKnexAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/knex"</span>;
<span class="kw">import</span> Knex <span class="kw">from</span> <span class="str">"knex"</span>;

<span class="kw">const</span> knex = <span class="fn">Knex</span><span class="br">(</span><span class="br">{</span> client: <span class="str">"pg"</span>, connection: process.env.<span class="var">DATABASE_URL</span> <span class="br">}</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"users"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organizations"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, <span class="fn">createKnexAdapter</span><span class="br">(</span>knex<span class="br">)</span><span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;

<span class="kw">if</span> <span class="br">(</span>result.available<span class="br">)</span> <span class="br">{</span>
  <span class="cm">// Safe to create</span>
<span class="br">}</span> <span class="kw">else</span> <span class="br">{</span>
  console.<span class="fn">log</span><span class="br">(</span>result.message<span class="br">)</span>;      <span class="cm">// "That name is already in use."</span>
  console.<span class="fn">log</span><span class="br">(</span>result.suggestions<span class="br">)</span>; <span class="cm">// ["acme-corp-1", "acme-corp-4821", "acme-corp1"]</span>
<span class="br">}</span></code></pre>
      </div>
      <div id="panel-typeorm" role="tabpanel" aria-labelledby="tab-typeorm" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createTypeORMAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/typeorm"</span>;
<span class="kw">import</span> <span class="br">{</span> DataSource <span class="br">}</span> <span class="kw">from</span> <span class="str">"typeorm"</span>;
<span class="kw">import</span> <span class="br">{</span> User, Organization <span class="br">}</span> <span class="kw">from</span> <span class="str">"./entities"</span>;

<span class="kw">const</span> dataSource = <span class="kw">new</span> <span class="fn">DataSource</span><span class="br">(</span><span class="br">{</span> <span class="cm">/* ... */</span> <span class="br">}</span><span class="br">)</span>;
<span class="kw">const</span> adapter = <span class="fn">createTypeORMAdapter</span><span class="br">(</span>dataSource, <span class="br">{</span> user: User, organization: Organization <span class="br">}</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"user"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organization"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, adapter<span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;</code></pre>
      </div>
      <div id="panel-mikroorm" role="tabpanel" aria-labelledby="tab-mikroorm" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createMikroORMAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/mikro-orm"</span>;
<span class="kw">import</span> <span class="br">{</span> MikroORM <span class="br">}</span> <span class="kw">from</span> <span class="str">"@mikro-orm/core"</span>;
<span class="kw">import</span> <span class="br">{</span> User, Organization <span class="br">}</span> <span class="kw">from</span> <span class="str">"./entities"</span>;

<span class="kw">const</span> orm = <span class="kw">await</span> MikroORM.<span class="fn">init</span><span class="br">(</span>config<span class="br">)</span>;
<span class="kw">const</span> adapter = <span class="fn">createMikroORMAdapter</span><span class="br">(</span>orm.em, <span class="br">{</span> user: User, organization: Organization <span class="br">}</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"user"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organization"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, adapter<span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;</code></pre>
      </div>
      <div id="panel-sequelize" role="tabpanel" aria-labelledby="tab-sequelize" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createSequelizeAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/sequelize"</span>;
<span class="kw">import</span> <span class="br">{</span> User, Organization <span class="br">}</span> <span class="kw">from</span> <span class="str">"./models"</span>;

<span class="kw">const</span> adapter = <span class="fn">createSequelizeAdapter</span><span class="br">(</span><span class="br">{</span> user: User, organization: Organization <span class="br">}</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"user"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organization"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, adapter<span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;</code></pre>
      </div>
      <div id="panel-mongoose" role="tabpanel" aria-labelledby="tab-mongoose" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createMongooseAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/mongoose"</span>;
<span class="kw">import</span> <span class="br">{</span> User, Organization <span class="br">}</span> <span class="kw">from</span> <span class="str">"./models"</span>;

<span class="kw">const</span> adapter = <span class="fn">createMongooseAdapter</span><span class="br">(</span><span class="br">{</span> user: User, organization: Organization <span class="br">}</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"user"</span>, column: <span class="str">"handle"</span>, idColumn: <span class="str">"_id"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organization"</span>, column: <span class="str">"slug"</span>, idColumn: <span class="str">"_id"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, adapter<span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;</code></pre>
      </div>
      <div id="panel-raw" role="tabpanel" aria-labelledby="tab-raw" class="adapter-panel">
        <pre class="code-block" tabindex="0"><code><span class="kw">import</span> <span class="br">{</span> <span class="fn">createNamespaceGuard</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard"</span>;
<span class="kw">import</span> <span class="br">{</span> <span class="fn">createRawAdapter</span> <span class="br">}</span> <span class="kw">from</span> <span class="str">"namespace-guard/adapters/raw"</span>;
<span class="kw">import</span> <span class="br">{</span> Pool <span class="br">}</span> <span class="kw">from</span> <span class="str">"pg"</span>;

<span class="kw">const</span> pool = <span class="kw">new</span> <span class="fn">Pool</span><span class="br">()</span>;
<span class="kw">const</span> adapter = <span class="fn">createRawAdapter</span><span class="br">(</span><span class="br">(</span>sql, params<span class="br">)</span> <span class="kw">=&gt;</span> pool.<span class="fn">query</span><span class="br">(</span>sql, params<span class="br">)</span><span class="br">)</span>;

<span class="kw">const</span> guard = <span class="fn">createNamespaceGuard</span><span class="br">(</span><span class="br">{</span>
  reserved: <span class="br">[</span><span class="str">"admin"</span>, <span class="str">"api"</span>, <span class="str">"settings"</span><span class="br">]</span>,
  sources: <span class="br">[</span>
    <span class="br">{</span> name: <span class="str">"users"</span>, column: <span class="str">"handle"</span> <span class="br">}</span>,
    <span class="br">{</span> name: <span class="str">"organizations"</span>, column: <span class="str">"slug"</span> <span class="br">}</span>,
  <span class="br">]</span>,
  suggest: <span class="br">{</span> strategy: <span class="br">[</span><span class="str">"sequential"</span>, <span class="str">"random-digits"</span><span class="br">]</span>, max: <span class="type">3</span> <span class="br">}</span>,
<span class="br">}</span>, adapter<span class="br">)</span>;

<span class="kw">const</span> result = <span class="kw">await</span> guard.<span class="fn">check</span><span class="br">(</span><span class="str">"acme-corp"</span><span class="br">)</span>;

<span class="kw">if</span> <span class="br">(</span>result.available<span class="br">)</span> <span class="br">{</span>
  <span class="cm">// Safe to create</span>
<span class="br">}</span> <span class="kw">else</span> <span class="br">{</span>
  console.<span class="fn">log</span><span class="br">(</span>result.message<span class="br">)</span>;      <span class="cm">// "That name is already in use."</span>
  console.<span class="fn">log</span><span class="br">(</span>result.suggestions<span class="br">)</span>; <span class="cm">// ["acme-corp-1", "acme-corp-4821", "acme-corp1"]</span>
<span class="br">}</span></code></pre>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- CLI workflow -->
    <section class="pipeline-section" aria-labelledby="workflow-heading">
      <h2 id="workflow-heading" class="display-type">Operational CLI workflow</h2>
      <p class="subtitle">Go from sample attacks to production checks in a few commands.</p>

      <div class="insight-cards">
        <div class="glass-card insight-card">
          <h3>1. Red-team with attack-gen</h3>
          <p>Generate realistic variants to test your policy. Default mode is <code class="inline-chip">evasion</code> (Unicode confusables + substitutions). Use <code class="inline-chip">--mode impersonation</code> when you only want Unicode spoofing analysis.</p>
          <div class="example">
            <span class="dim">$</span> <span class="kw">npx</span> <span class="fn">namespace-guard</span> <span class="fn">attack-gen</span> <span class="str">paypal</span> <span class="var">--json</span><br>
            <span class="dim">$</span> <span class="kw">npx</span> <span class="fn">namespace-guard</span> <span class="fn">attack-gen</span> <span class="str">shit</span> <span class="var">--mode</span> <span class="str">evasion</span> <span class="var">--json</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>2. Recommend in one command</h3>
          <p>Get recommended warn/block thresholds and a suggested CI command from your dataset.</p>
          <div class="example">
            <span class="dim">$</span> <span class="kw">npx</span> <span class="fn">namespace-guard</span> <span class="fn">recommend</span> <span class="str">./risk-dataset.json</span><br>
            <span class="cm"># emits recommended risk config + CI gate command</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>3. Cost-aware tuning when needed</h3>
          <p>Override default costs and class priors to tune for your domain's false-positive and false-negative tradeoffs.</p>
          <div class="example">
            <span class="dim">$</span> <span class="kw">npx</span> <span class="fn">namespace-guard</span> <span class="fn">calibrate</span> <span class="str">./risk-dataset.json</span> <span class="br">\</span><br>
            &nbsp;&nbsp;<span class="var">--cost-block-benign</span> <span class="type">8</span> <span class="var">--cost-allow-malicious</span> <span class="type">12</span> <span class="var">--malicious-prior</span> <span class="type">0.05</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>4. Compare map behavior</h3>
          <p>See how results change between <code class="inline-chip">CONFUSABLE_MAP_FULL</code> and <code class="inline-chip">CONFUSABLE_MAP</code>.</p>
          <div class="example">
            <span class="dim">$</span> <span class="kw">npx</span> <span class="fn">namespace-guard</span> <span class="fn">drift</span> <span class="var">--json</span><br>
            <span class="cm"># includes actionFlips, averageScoreDelta, maxAbsScoreDelta</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>5. Enforce in CI</h3>
          <p>Fail pull requests when changes exceed the limits you set.</p>
          <div class="example">
            <span class="dim">$</span> <span class="kw">npm</span> <span class="fn">run</span> <span class="fn">ci:drift-gate</span> <span class="var">--</span> <span class="br">\</span><br>
            &nbsp;&nbsp;<span class="var">--max-action-flips</span> <span class="type">29</span> <span class="var">--max-average-score-delta</span> <span class="type">95</span> <span class="var">--max-abs-score-delta</span> <span class="type">100</span>
          </div>
        </div>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- Profanity and evasion -->
    <section class="pipeline-section" aria-labelledby="profanity-heading">
      <h2 id="profanity-heading" class="display-type">Profanity &amp; Evasion</h2>
      <p class="subtitle">Keep moderation dependency-free by default, and plug in any external library when you need it.</p>

      <div class="insight-cards">
        <div class="glass-card insight-card">
          <h3>Built-in profanity validator</h3>
          <p><code class="inline-chip">createProfanityValidator</code> catches common obfuscation while staying conservative by default: <code class="inline-chip">variantProfile: "balanced"</code> and <code class="inline-chip">minSubstringLength: 4</code>.</p>
          <div class="example">
            <span class="kw">const</span> validator = <span class="fn">createProfanityValidator</span><span class="br">(</span><span class="br">[</span><span class="str">"word"</span><span class="br">]</span>, <span class="br">{</span> <span class="var">mode</span>: <span class="str">"evasion"</span> <span class="br">}</span><span class="br">)</span>;<br>
            <span class="dim"># catches common evasion like leet and confusables</span><br>
            <span class="dim"># avoids broad matches on very short tokens</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>Use a default list or your own</h3>
          <p>For quick setup, use <code class="inline-chip">namespace-guard/profanity-en</code>. Or keep bring-your-own moderation with <code class="inline-chip">createPredicateValidator</code>.</p>
          <div class="example">
            <span class="dim">// one-liner default list</span><br>
            <span class="var">validators</span>: <span class="br">[</span><span class="fn">createEnglishProfanityValidator</span><span class="br">()</span><span class="br">]</span><br>
            <span class="dim">// external library path also supported</span><br>
            <span class="var">validators</span>: <span class="br">[</span><span class="fn">createPredicateValidator</span><span class="br">((</span>id<span class="br">)</span> =&gt; profanity.<span class="fn">exists</span><span class="br">(</span>id<span class="br">))]</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>Increase strictness carefully</h3>
          <p>Only switch to <code class="inline-chip">variantProfile: "aggressive"</code> or shorter substring lengths after checking false positives.</p>
          <div class="example">
            <span class="dim">// safer default</span><br>
            <span class="br">{</span> <span class="var">variantProfile</span>: <span class="str">"balanced"</span>, <span class="var">minSubstringLength</span>: <span class="type">4</span> <span class="br">}</span><br>
            <span class="dim">// stricter mode</span><br>
            <span class="br">{</span> <span class="var">variantProfile</span>: <span class="str">"aggressive"</span>, <span class="var">minSubstringLength</span>: <span class="type">3</span> <span class="br">}</span>
          </div>
        </div>
      </div>
    </section>

    <div class="divider" aria-hidden="true"></div>

    <!-- Anti-spoofing pipeline -->
    <section class="pipeline-section" aria-labelledby="pipeline-heading">
      <h2 id="pipeline-heading" class="display-type">Anti-spoofing pipeline</h2>
      <p class="subtitle">Three clear steps for Unicode spoof detection.</p>

      <div class="pipeline-flow">
        <div class="pipeline-stage">
          <span class="stage-num">Stage 1</span>
          <span class="stage-name">NFKC normalize</span>
          <span class="stage-desc">Collapses compatibility forms</span>
        </div>
        <span class="pipeline-arrow" aria-hidden="true">&rarr;</span>
        <div class="pipeline-stage">
          <span class="stage-num">Stage 2</span>
          <span class="stage-name">Confusable map</span>
          <span class="stage-desc">613 TR39 character pairs</span>
        </div>
        <span class="pipeline-arrow" aria-hidden="true">&rarr;</span>
        <div class="pipeline-stage">
          <span class="stage-num">Stage 3</span>
          <span class="stage-name">Mixed-script reject</span>
          <span class="stage-desc">19+ script families</span>
        </div>
      </div>

      <div class="insight-cards">
        <div class="glass-card insight-card">
          <h3>NFKC-aware confusable map</h3>
          <p>TR39 and NFKC do not always map characters the same way. namespace-guard accounts for those differences so normalized pipelines use the right mapping. Need the full unfiltered map? <code class="inline-chip">CONFUSABLE_MAP_FULL</code> (~1,400 entries) is exported for non-NFKC pipelines.</p>
          <div class="example">
            <span class="dim">// TR39 says Long S (&lsaquo;&#x17F;&rsaquo;) &rarr; &ldquo;f&rdquo;</span><br>
            <span class="dim">// NFKC says Long S &rarr; &ldquo;s&rdquo;</span> <span class="val">&larr; correct</span><br>
            <span class="dim">// TR39 says Math Bold I (&lsaquo;&#x1D408;&rsaquo;) &rarr; &ldquo;l&rdquo;</span><br>
            <span class="dim">// NFKC says Math Bold I &rarr; &ldquo;i&rdquo;</span> <span class="val">&larr; correct</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>Full Unicode script coverage</h3>
          <p>The confusable map covers 20+ scripts from the Unicode Consortium's authoritative source. Mixed-script detection goes further, blocking Latin mixed with Hebrew, Arabic, Devanagari, Thai, Georgian, Ethiopic, and more.</p>
          <div class="example">
            <span class="err">&#x430;dmin</span> <span class="dim">Cyrillic &ldquo;a&rdquo; + Latin</span><br>
            <span class="err">&#x570;ello</span> <span class="dim">Armenian &ldquo;h&rdquo; + Latin</span><br>
            <span class="err">&#x251;dmin</span> <span class="dim">IPA &ldquo;a&rdquo; + Latin</span><br>
            <span class="err">&#x13AA;dmin</span> <span class="dim">Cherokee &ldquo;A&rdquo; + Latin</span>
          </div>
        </div>
        <div class="glass-card insight-card">
          <h3>Reproducible from source</h3>
          <p>The map is generated from Unicode's official <code class="inline-chip">confusables.txt</code>, not hand-curated. Run <code class="inline-chip">npx tsx scripts/generate-confusables.ts</code> to regenerate for new Unicode versions. The script automatically excludes NFKC conflicts.</p>
        </div>
        <div class="glass-card insight-card">
          <h3>Defense in depth</h3>
          <p>The default slug pattern <code class="inline-chip">/^[a-z0-9][a-z0-9-]*$/</code> already blocks non-ASCII. The confusable map and mixed-script detection protect apps with permissive patterns that allow Unicode identifiers, or serve as a second line of defense if a format regex is misconfigured.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="shell">
    <div class="install-bar">
      <code><span class="prefix">$</span> npm install namespace-guard</code>
      <button class="copy-btn" id="copy-btn" aria-label="Copy install command">Copy</button>
    </div>
    <div class="footer-links">
      <a href="https://github.com/paultendo/namespace-guard" target="_blank" rel="noopener">GitHub</a>
      <a href="https://www.npmjs.com/package/namespace-guard" target="_blank" rel="noopener">npm</a>
      <a href="https://github.com/sponsors/paultendo" target="_blank" rel="noopener">Sponsor</a>
      <a href="https://buymeacoffee.com/paultendo" target="_blank" rel="noopener">Buy me a coffee</a>
      <span style="color: rgba(188,201,223,0.3)">MIT License</span>
    </div>
    <div class="footer-author">Built by <a href="https://github.com/paultendo" target="_blank" rel="noopener" style="color: rgba(188,201,223,0.6); text-decoration: none;">Paul Wood FRSA (@paultendo)</a></div>
  </footer>

  <script src="./data/profanity-words.global.js"></script>
  <script type="module">
    // === namespace-guard playground runtime (v0.12.0-aligned subset) ===
    var DEFAULT_PATTERN = /^[a-z0-9][a-z0-9-]{1,29}$/;
    var DEFAULT_MESSAGES = {
      invalid: "Use 2\u201330 lowercase letters, numbers, or hyphens.",
      reserved: "That name is reserved. Try another one.",
      taken: (source) => `That name is already in use.`,
      purelyNumeric: "Identifiers cannot be purely numeric.",
    };
    var SUFFIX_WORDS = ["dev", "io", "app", "hq", "pro", "team", "labs", "hub", "go", "one"];

    // Generated from Unicode TR39 confusables.txt + supplemental Latin small capitals (613 entries)
    // NFKC-conflict entries excluded (NFKC normalization runs first in the pipeline)
    var CONFUSABLE_MAP = {
      "\u00d7":"x","\u00fe":"p","\u0131":"i","\u0184":"b","\u018d":"g","\u0192":"f","\u0196":"l",
      "\u01a6":"r","\u01a7":"2","\u01b7":"3","\u01bc":"5","\u01bd":"s","\u01bf":"p","\u01c0":"l","\u021c":"3",
      "\u0222":"8","\u0223":"8","\u0251":"a","\u0261":"g","\u0263":"y","\u0269":"i","\u026a":"i","\u026f":"w",
      "\u028b":"u","\u028f":"y","\u02db":"i","\u037a":"i","\u037f":"j","\u0391":"a","\u0392":"b","\u0395":"e",
      "\u0396":"z","\u0397":"h","\u0399":"l","\u039a":"k","\u039c":"m","\u039d":"n","\u039f":"o","\u03a1":"p",
      "\u03a4":"t","\u03a5":"y","\u03a7":"x","\u03b1":"a","\u03b3":"y","\u03b9":"i","\u03bd":"v","\u03bf":"o",
      "\u03c1":"p","\u03c3":"o","\u03c5":"u","\u03d2":"y","\u03dc":"f","\u03e8":"2","\u03ec":"6","\u03ed":"o",
      "\u03f1":"p","\u03f2":"c","\u03f3":"j","\u03f8":"p","\u03f9":"c","\u03fa":"m","\u0405":"s","\u0406":"l",
      "\u0408":"j","\u0410":"a","\u0412":"b","\u0415":"e","\u0417":"3","\u041a":"k","\u041c":"m","\u041d":"h",
      "\u041e":"o","\u0420":"p","\u0421":"c","\u0422":"t","\u0423":"y","\u0425":"x","\u042c":"b","\u0430":"a",
      "\u0431":"6","\u0433":"r","\u0435":"e","\u043e":"o","\u0440":"p","\u0441":"c","\u0443":"y","\u0445":"x",
      "\u0448":"w","\u0455":"s","\u0456":"i","\u0458":"j","\u0461":"w","\u0474":"v","\u0475":"v","\u04ae":"y",
      "\u04af":"y","\u04bb":"h","\u04bd":"e","\u04c0":"l","\u04cf":"l","\u04e0":"3","\u0501":"d","\u050c":"g",
      "\u051b":"q","\u051c":"w","\u051d":"w","\u054d":"u","\u054f":"s","\u0555":"o","\u0561":"w","\u0563":"q",
      "\u0566":"q","\u0570":"h","\u0578":"n","\u057c":"n","\u057d":"u","\u0581":"g","\u0582":"i","\u0584":"f",
      "\u0585":"o","\u05c0":"l","\u05d5":"l","\u05d8":"v","\u05df":"l","\u05e1":"o","\u0627":"l","\u0647":"o",
      "\u0661":"l","\u0665":"o","\u0667":"v","\u06be":"o","\u06c1":"o","\u06d5":"o","\u06f1":"l","\u06f5":"o",
      "\u06f7":"v","\u07c0":"o","\u07ca":"l","\u0966":"o","\u0969":"3","\u09e6":"o","\u09ea":"8","\u09ed":"9",
      "\u0a66":"o","\u0a67":"9","\u0a6a":"8","\u0ae6":"o","\u0ae9":"3","\u0b03":"8","\u0b20":"o","\u0b66":"o",
      "\u0b68":"9","\u0be6":"o","\u0c02":"o","\u0c66":"o","\u0c82":"o","\u0ce6":"o","\u0d02":"o","\u0d1f":"s",
      "\u0d20":"o","\u0d66":"o","\u0d6d":"9","\u0d82":"o","\u0e50":"o","\u0ed0":"o","\u1004":"c","\u101d":"o",
      "\u1040":"o","\u105a":"c","\u10e7":"y","\u10ff":"o","\u1200":"u","\u12d0":"o","\u13a0":"d","\u13a1":"r",
      "\u13a2":"t","\u13a5":"i","\u13a9":"y","\u13aa":"a","\u13ab":"j","\u13ac":"e","\u13b3":"w","\u13b7":"m",
      "\u13bb":"h","\u13bd":"y","\u13c0":"g","\u13c2":"h","\u13c3":"z","\u13ce":"4","\u13cf":"b","\u13d2":"r",
      "\u13d4":"w","\u13d5":"s","\u13d9":"v","\u13da":"s","\u13de":"l","\u13df":"c","\u13e2":"p","\u13e6":"k",
      "\u13e7":"d","\u13ee":"6","\u13f3":"g","\u13f4":"b","\u142f":"v","\u144c":"u","\u146d":"p","\u146f":"d",
      "\u1472":"b","\u148d":"j","\u14aa":"l","\u14bf":"2","\u1541":"x","\u157c":"h","\u157d":"x","\u1587":"r",
      "\u15af":"b","\u15b4":"f","\u15c5":"a","\u15de":"d","\u15ea":"d","\u15f0":"m","\u15f7":"b","\u166d":"x",
      "\u166e":"x","\u16b7":"x","\u16c1":"l","\u16d5":"k","\u16d6":"m","\u17e0":"o","\u1d00":"a","\u1d04":"c",
      "\u1d05":"d","\u1d07":"e","\u1d0a":"j","\u1d0b":"k","\u1d0d":"m","\u1d0f":"o","\u1d11":"o","\u1d18":"p",
      "\u1d1b":"t","\u1d1c":"u","\u1d20":"v","\u1d21":"w","\u1d22":"z","\u1d26":"r","\u1d83":"g","\u1d8c":"y",
      "\u1e9d":"f","\u1eff":"y","\u1fbe":"i","\u212e":"e","\u213d":"y",
      "\u2223":"l","\u2228":"v","\u222a":"u","\u22a4":"t","\u22c1":"v","\u22c3":"u","\u22ff":"e","\u2373":"i",
      "\u2374":"p","\u237a":"a","\u23fd":"l","\u2573":"x","\u27d9":"t","\u292b":"x","\u292c":"x","\u2a2f":"x",
      "\u2c82":"b","\u2c85":"r","\u2c8e":"h","\u2c92":"l","\u2c93":"i","\u2c94":"k","\u2c98":"m","\u2c9a":"n",
      "\u2c9c":"3","\u2c9e":"o","\u2c9f":"o","\u2ca2":"p","\u2ca3":"p","\u2ca4":"c","\u2ca5":"c","\u2ca6":"t",
      "\u2ca8":"y","\u2ca9":"y","\u2cac":"x","\u2cbd":"w","\u2cc4":"3","\u2cca":"9","\u2ccb":"9","\u2ccc":"3",
      "\u2cce":"p","\u2ccf":"p","\u2cd0":"l","\u2cd2":"6","\u2cd3":"6","\u2cdc":"6","\u2d38":"v","\u2d39":"e",
      "\u2d4f":"l","\u2d54":"o","\u2d55":"q","\u2d5d":"x","\u3007":"o","\ua4d0":"b","\ua4d1":"p","\ua4d2":"d",
      "\ua4d3":"d","\ua4d4":"t","\ua4d6":"g","\ua4d7":"k","\ua4d9":"j","\ua4da":"c","\ua4dc":"z","\ua4dd":"f",
      "\ua4df":"m","\ua4e0":"n","\ua4e1":"l","\ua4e2":"s","\ua4e3":"r","\ua4e6":"v","\ua4e7":"h","\ua4ea":"w",
      "\ua4eb":"x","\ua4ec":"y","\ua4ee":"a","\ua4f0":"e","\ua4f2":"l","\ua4f3":"o","\ua4f4":"u","\ua644":"2",
      "\ua647":"i","\ua6df":"v","\ua6ef":"2","\ua731":"s","\ua75a":"2","\ua76a":"3","\ua76e":"9","\ua798":"f",
      "\ua799":"f","\ua79f":"u","\ua7ab":"3","\ua7b2":"j","\ua7b3":"x","\ua7b4":"b","\uab32":"e","\uab35":"f",
      "\uab3d":"o","\uab47":"r","\uab48":"r","\uab4e":"u","\uab52":"u","\uab5a":"y","\uab75":"i","\uab81":"r",
      "\uab83":"w","\uab93":"z","\uaba9":"v","\uabaa":"s","\uabaf":"c","\ufba6":"o","\ufba7":"o","\ufba8":"o",
      "\ufba9":"o","\ufbaa":"o","\ufbab":"o","\ufbac":"o","\ufbad":"o","\ufe8d":"l","\ufe8e":"l","\ufee9":"o",
      "\ufeea":"o","\ufeeb":"o","\ufeec":"o","\uffe8":"l",
      "\u{10282}":"b","\u{10286}":"e","\u{10287}":"f","\u{1028a}":"l","\u{10290}":"x","\u{10292}":"o",
      "\u{10295}":"p","\u{10296}":"s","\u{10297}":"t","\u{102a0}":"a","\u{102a1}":"b","\u{102a2}":"c",
      "\u{102a5}":"f","\u{102ab}":"o","\u{102b0}":"m","\u{102b1}":"t","\u{102b2}":"y","\u{102b4}":"x",
      "\u{102cf}":"h","\u{102f5}":"z","\u{10301}":"b","\u{10302}":"c","\u{10309}":"l","\u{10311}":"m",
      "\u{10315}":"t","\u{10317}":"x","\u{1031a}":"8","\u{10320}":"l","\u{10322}":"x","\u{10404}":"o",
      "\u{10415}":"c","\u{1041b}":"l","\u{10420}":"s","\u{1042c}":"o","\u{1043d}":"c","\u{10448}":"s",
      "\u{104b4}":"r","\u{104c2}":"o","\u{104ce}":"u","\u{104d2}":"7","\u{104ea}":"o","\u{104f6}":"u",
      "\u{10513}":"n","\u{10516}":"o","\u{10518}":"k","\u{1051c}":"c","\u{1051d}":"v","\u{10525}":"f",
      "\u{10526}":"l","\u{10527}":"x","\u{114d0}":"o","\u{11706}":"v","\u{1170a}":"w","\u{1170e}":"w",
      "\u{1170f}":"w","\u{118a0}":"v","\u{118a2}":"f","\u{118a3}":"l","\u{118a4}":"y","\u{118a6}":"e",
      "\u{118a9}":"z","\u{118ac}":"9","\u{118ae}":"e","\u{118af}":"4","\u{118b2}":"l","\u{118b5}":"o",
      "\u{118b8}":"u","\u{118bb}":"5","\u{118bc}":"t","\u{118c0}":"v","\u{118c1}":"s","\u{118c2}":"f",
      "\u{118c3}":"i","\u{118c4}":"z","\u{118c6}":"7","\u{118c8}":"o","\u{118ca}":"3","\u{118cc}":"9",
      "\u{118d5}":"6","\u{118d6}":"9","\u{118d7}":"o","\u{118d8}":"u","\u{118dc}":"y","\u{118e0}":"o",
      "\u{118e5}":"z","\u{118e6}":"w","\u{118e9}":"c","\u{118ec}":"x","\u{118ef}":"w","\u{118f2}":"c",
      "\u{11dda}":"l","\u{11de0}":"o","\u{11de1}":"l","\u{16eaa}":"l","\u{16eb6}":"b","\u{16f08}":"v",
      "\u{16f0a}":"t","\u{16f16}":"l","\u{16f28}":"l","\u{16f35}":"r","\u{16f3a}":"s","\u{16f3b}":"3",
      "\u{16f40}":"a","\u{16f42}":"u","\u{16f43}":"y","\u{1d206}":"3","\u{1d20d}":"v","\u{1d212}":"7",
      "\u{1d213}":"f","\u{1d216}":"r","\u{1d22a}":"l","\u{1d6a4}":"i",
      "\u{1d6a8}":"a","\u{1d6a9}":"b","\u{1d6ac}":"e","\u{1d6ad}":"z","\u{1d6ae}":"h","\u{1d6b0}":"l",
      "\u{1d6b1}":"k","\u{1d6b3}":"m","\u{1d6b4}":"n","\u{1d6b6}":"o","\u{1d6b8}":"p","\u{1d6bb}":"t",
      "\u{1d6bc}":"y","\u{1d6be}":"x","\u{1d6c2}":"a","\u{1d6c4}":"y","\u{1d6ca}":"i","\u{1d6ce}":"v",
      "\u{1d6d0}":"o","\u{1d6d2}":"p","\u{1d6d4}":"o","\u{1d6d6}":"u","\u{1d6e0}":"p","\u{1d6e2}":"a",
      "\u{1d6e3}":"b","\u{1d6e6}":"e","\u{1d6e7}":"z","\u{1d6e8}":"h","\u{1d6ea}":"l","\u{1d6eb}":"k",
      "\u{1d6ed}":"m","\u{1d6ee}":"n","\u{1d6f0}":"o","\u{1d6f2}":"p","\u{1d6f5}":"t","\u{1d6f6}":"y",
      "\u{1d6f8}":"x","\u{1d6fc}":"a","\u{1d6fe}":"y","\u{1d704}":"i","\u{1d708}":"v","\u{1d70a}":"o",
      "\u{1d70c}":"p","\u{1d70e}":"o","\u{1d710}":"u","\u{1d71a}":"p","\u{1d71c}":"a","\u{1d71d}":"b",
      "\u{1d720}":"e","\u{1d721}":"z","\u{1d722}":"h","\u{1d724}":"l","\u{1d725}":"k","\u{1d727}":"m",
      "\u{1d728}":"n","\u{1d72a}":"o","\u{1d72c}":"p","\u{1d72f}":"t","\u{1d730}":"y","\u{1d732}":"x",
      "\u{1d736}":"a","\u{1d738}":"y","\u{1d73e}":"i","\u{1d742}":"v","\u{1d744}":"o","\u{1d746}":"p",
      "\u{1d748}":"o","\u{1d74a}":"u","\u{1d754}":"p","\u{1d756}":"a","\u{1d757}":"b","\u{1d75a}":"e",
      "\u{1d75b}":"z","\u{1d75c}":"h","\u{1d75e}":"l","\u{1d75f}":"k","\u{1d761}":"m","\u{1d762}":"n",
      "\u{1d764}":"o","\u{1d766}":"p","\u{1d769}":"t","\u{1d76a}":"y","\u{1d76c}":"x","\u{1d770}":"a",
      "\u{1d772}":"y","\u{1d778}":"i","\u{1d77c}":"v","\u{1d77e}":"o","\u{1d780}":"p","\u{1d782}":"o",
      "\u{1d784}":"u","\u{1d78e}":"p","\u{1d790}":"a","\u{1d791}":"b","\u{1d794}":"e","\u{1d795}":"z",
      "\u{1d796}":"h","\u{1d798}":"l","\u{1d799}":"k","\u{1d79b}":"m","\u{1d79c}":"n","\u{1d79e}":"o",
      "\u{1d7a0}":"p","\u{1d7a3}":"t","\u{1d7a4}":"y","\u{1d7a6}":"x","\u{1d7aa}":"a","\u{1d7ac}":"y",
      "\u{1d7b2}":"i","\u{1d7b6}":"v","\u{1d7b8}":"o","\u{1d7ba}":"p","\u{1d7bc}":"o","\u{1d7be}":"u",
      "\u{1d7c8}":"p","\u{1d7ca}":"f","\u{1e8c7}":"l","\u{1e8cb}":"8","\u{1ee00}":"l","\u{1ee24}":"o",
      "\u{1ee64}":"o","\u{1ee80}":"l","\u{1ee84}":"o","\u{1f74c}":"c","\u{1f768}":"t",
    };

    // Script name lookup for rich homoglyph detail
    function getScriptName(cp) {
      if (cp >= 0x0370 && cp <= 0x03FF) return "Greek";
      if (cp >= 0x0400 && cp <= 0x052F) return "Cyrillic";
      if (cp >= 0x0530 && cp <= 0x058F) return "Armenian";
      if (cp >= 0x0590 && cp <= 0x05FF) return "Hebrew";
      if (cp >= 0x0600 && cp <= 0x074F) return "Arabic";
      if (cp >= 0x0900 && cp <= 0x097F) return "Devanagari";
      if (cp >= 0x0980 && cp <= 0x09FF) return "Bengali";
      if (cp >= 0x0A00 && cp <= 0x0A7F) return "Gurmukhi";
      if (cp >= 0x0A80 && cp <= 0x0AFF) return "Gujarati";
      if (cp >= 0x0B00 && cp <= 0x0B7F) return "Oriya";
      if (cp >= 0x0B80 && cp <= 0x0BFF) return "Tamil";
      if (cp >= 0x0C00 && cp <= 0x0C7F) return "Telugu";
      if (cp >= 0x0C80 && cp <= 0x0CFF) return "Kannada";
      if (cp >= 0x0D00 && cp <= 0x0DFF) return "Malayalam";
      if (cp >= 0x0E00 && cp <= 0x0E7F) return "Thai";
      if (cp >= 0x0E80 && cp <= 0x0EFF) return "Lao";
      if (cp >= 0x1000 && cp <= 0x109F) return "Myanmar";
      if (cp >= 0x10A0 && cp <= 0x10FF) return "Georgian";
      if (cp >= 0x1200 && cp <= 0x137F) return "Ethiopic";
      if (cp >= 0x13A0 && cp <= 0x13FF) return "Cherokee";
      if (cp >= 0x1400 && cp <= 0x167F) return "Canadian Syllabics";
      if (cp >= 0x16A0 && cp <= 0x16FF) return "Runic";
      if (cp >= 0x1780 && cp <= 0x17FF) return "Khmer";
      if (cp >= 0x1D00 && cp <= 0x1D7F) return "Latin Small Capital";
      if (cp >= 0x0250 && cp <= 0x02AF) return "IPA";
      if (cp >= 0x2C80 && cp <= 0x2CFF) return "Coptic";
      if (cp >= 0x2D30 && cp <= 0x2D7F) return "Tifinagh";
      if (cp >= 0xA4D0 && cp <= 0xA4FF) return "Lisu";
      if (cp >= 0xA6A0 && cp <= 0xA6FF) return "Bamum";
      if (cp >= 0xAB70 && cp <= 0xABBF) return "Cherokee";
      return "non-Latin";
    }

    function createHomoglyphValidator(options) {
      const map = { ...CONFUSABLE_MAP, ...(options?.additionalMappings ?? {}) };
      const chars = Object.keys(map);
      const re = new RegExp("[" + chars.map(c => c.replace(/[\\\]^-]/g, "\\$&")).join("") + "]");
      const checkConfusables = options?.checkConfusables ?? true;
      const mixed = options?.rejectMixedScript ?? false;
      const nonLatinRe = /[\u0370-\u03FF\u0400-\u04FF\u0500-\u052F\u0530-\u058F\u0590-\u05FF\u0600-\u074F\u0900-\u0DFF\u0E00-\u0EFF\u1000-\u109F\u10A0-\u10FF\u1200-\u137F\u13A0-\u13FF\u1400-\u167F\u16A0-\u16FF\u1780-\u17FF\u2C80-\u2CFF\u2D30-\u2D7F\uA4D0-\uA4FF\uA6A0-\uA6FF\uAB70-\uABBF]/;
      return async (value) => {
        // Check confusable map - find the first offending character
        if (checkConfusables && re.test(value)) {
          for (const ch of value) {
            if (map[ch]) {
              const cp = ch.codePointAt(0);
              const hex = "U+" + cp.toString(16).toUpperCase().padStart(4, "0");
              const script = getScriptName(cp);
              return {
                available: false,
                message: `Contains ${script} "${ch}" (${hex}) which looks like Latin "${map[ch]}".`,
                _confusableChar: ch,
                _confusableTarget: map[ch],
                _confusableScript: script,
              };
            }
          }
        }
        // Check mixed-script
        if (mixed) {
          const hasLatin = /[a-zA-Z]/.test(value);
          const hasNonLatin = nonLatinRe.test(value);
          if (hasLatin && hasNonLatin) {
            // Find the first non-Latin char for detail
            for (const ch of value) {
              const cp = ch.codePointAt(0);
              if (nonLatinRe.test(ch)) {
                const hex = "U+" + cp.toString(16).toUpperCase().padStart(4, "0");
                const script = getScriptName(cp);
                return {
                  available: false,
                  message: `Mixes Latin with ${script} characters - possible spoofing attempt.`,
                  _mixedScriptChar: ch,
                  _mixedScript: script,
                };
              }
            }
            return { available: false, message: "Mixes Latin with non-Latin characters." };
          }
        }
        return null;
      };
    }

    const PROFANITY_SUBSTITUTE_MAP_BALANCED = {
      "0": ["o"],
      "1": ["i"],
      "3": ["e"],
      "4": ["a"],
      "5": ["s"],
      "7": ["t"],
      "@": ["a"],
      "$": ["s"],
      "+": ["t"],
      "!": ["i"],
      "|": ["i"],
    };
    const PROFANITY_SUBSTITUTE_MAP_AGGRESSIVE = {
      ...PROFANITY_SUBSTITUTE_MAP_BALANCED,
      "1": ["i", "l"],
      "2": ["z"],
      "6": ["g"],
      "8": ["b"],
      "9": ["g"],
      "!": ["i", "l"],
      "|": ["i", "l"],
    };
    const ASCII_ALNUM_RE = /^[a-z0-9]$/;
    const NON_ASCII_ALNUM_RE = /[^a-z0-9]+/g;

    function escapeRegex(value) {
      return value.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    function buildProfanityFoldCandidates(value, map, substituteMap, maxVariants) {
      const skeletonized = skeleton(value, map);
      let candidates = [""];

      for (const ch of skeletonized) {
        const options = new Set();
        if (ASCII_ALNUM_RE.test(ch)) {
          options.add(ch);
        } else {
          options.add("");
        }

        const substitutes = substituteMap[ch] ?? [];
        for (const substitute of substitutes) options.add(substitute);
        if (options.size === 0) options.add("");

        const next = [];
        const seen = new Set();
        for (const prefix of candidates) {
          for (const option of options) {
            const candidate = prefix + option;
            if (seen.has(candidate)) continue;
            seen.add(candidate);
            next.push(candidate);
            if (next.length >= maxVariants) break;
          }
          if (next.length >= maxVariants) break;
        }
        if (next.length > 0) candidates = next;
      }

      return Array.from(
        new Set(
          candidates
            .map((candidate) => candidate.replace(NON_ASCII_ALNUM_RE, ""))
            .filter(Boolean)
        )
      );
    }

    function createProfanityValidator(words, options = {}) {
      const message = options.message ?? "That handle is blocked by moderation policy.";
      const checkSubstrings = options.checkSubstrings ?? true;
      const mode = options.mode ?? "evasion";
      const variantProfile = options.variantProfile === "aggressive" ? "aggressive" : "balanced";
      const substituteMap =
        variantProfile === "aggressive"
          ? PROFANITY_SUBSTITUTE_MAP_AGGRESSIVE
          : PROFANITY_SUBSTITUTE_MAP_BALANCED;
      const foldMap = options.map ?? CONFUSABLE_MAP;
      const minSubstringLength = Math.max(1, Math.floor(options.minSubstringLength ?? 4));
      const maxFoldVariants = Math.max(1, Math.floor(options.maxFoldVariants ?? 64));

      const rawWords = words.map((w) => normalize(w)).filter(Boolean);
      const wordSet = new Set(rawWords);

      const substringWords = checkSubstrings
        ? Array.from(wordSet).filter((w) => w.length >= minSubstringLength)
        : [];
      const substringRegex = substringWords.length > 0
        ? new RegExp(substringWords.map((w) => escapeRegex(w)).join("|"))
        : null;

      const foldedExactWordSet = mode === "evasion"
        ? new Set(
          rawWords.flatMap((word) =>
            buildProfanityFoldCandidates(
              word,
              foldMap,
              substituteMap,
              Math.min(16, maxFoldVariants)
            )
          )
        )
        : null;

      const foldedSubstringWordSet = mode === "evasion" && checkSubstrings
        ? new Set(
          rawWords
            .filter((word) => word.length >= minSubstringLength)
            .flatMap((word) =>
              buildProfanityFoldCandidates(
                word,
                foldMap,
                substituteMap,
                Math.min(16, maxFoldVariants)
              )
            )
        )
        : null;

      const foldedSubstringRegex = mode === "evasion" &&
        checkSubstrings &&
        foldedSubstringWordSet &&
        foldedSubstringWordSet.size > 0
        ? new RegExp(Array.from(foldedSubstringWordSet).map((w) => escapeRegex(w)).join("|"))
        : null;

      return async (value) => {
        const normalized = normalize(value);

        if (wordSet.has(normalized)) {
          return { available: false, message };
        }
        if (substringRegex && substringRegex.test(normalized)) {
          return { available: false, message };
        }

        if (mode === "evasion" && foldedExactWordSet && foldedExactWordSet.size > 0) {
          const foldedCandidates = buildProfanityFoldCandidates(
            normalized,
            foldMap,
            substituteMap,
            maxFoldVariants
          );
          if (foldedCandidates.some((candidate) => foldedExactWordSet.has(candidate))) {
            return { available: false, message };
          }
          if (
            foldedSubstringRegex &&
            foldedCandidates.some((candidate) => foldedSubstringRegex.test(candidate))
          ) {
            return { available: false, message };
          }
        }

        return null;
      };
    }

    const DEMO_PROFANITY_WORDS_URL = "./data/profanity-words.json";
    const DEMO_PROFANITY_GLOBAL_KEY = "__NG_PROFANITY_WORDS__";
    let demoProfanityWords = [];
    let profanityWordCount = 0;

    var DEFAULT_PROTECTED_TOKENS = [
      "admin", "administrator", "support", "help", "security", "billing", "payments",
      "staff", "moderator", "root", "system", "api", "www", "mail", "login",
    ];

    var NAMESPACE_PROFILES = {
      "consumer-handle": {
        pattern: /^[a-z0-9][a-z0-9-]{1,29}$/,
        normalizeUnicode: true,
        allowPurelyNumeric: false,
        risk: {
          includeReserved: true,
          protect: [],
          maxMatches: 3,
          warnThreshold: 45,
          blockThreshold: 70,
        },
      },
      "org-slug": {
        pattern: /^[a-z0-9][a-z0-9-]{1,39}$/,
        normalizeUnicode: true,
        allowPurelyNumeric: false,
        risk: {
          includeReserved: true,
          protect: [],
          maxMatches: 5,
          warnThreshold: 40,
          blockThreshold: 65,
        },
      },
      "developer-id": {
        pattern: /^[a-z0-9][a-z0-9-]{1,49}$/,
        normalizeUnicode: true,
        allowPurelyNumeric: true,
        risk: {
          includeReserved: true,
          protect: [],
          maxMatches: 5,
          warnThreshold: 35,
          blockThreshold: 60,
        },
      },
    };

    var NON_LATIN_RE = /[\u0370-\u03FF\u0400-\u04FF\u0500-\u052F\u0530-\u058F\u0590-\u05FF\u0600-\u074F\u0900-\u0DFF\u0E00-\u0EFF\u1000-\u109F\u10A0-\u10FF\u1200-\u137F\u13A0-\u13FF\u1400-\u167F\u16A0-\u16FF\u1780-\u17FF\u2C80-\u2CFF\u2D30-\u2D7F\uA4D0-\uA4FF\uA6A0-\uA6FF\uAB70-\uABBF]/;
    var DEFAULT_IGNORABLE_RE = /[\u00AD\u034F\u061C\u115F\u1160\u17B4\u17B5\u180B-\u180F\u200B-\u200F\u202A-\u202E\u2060-\u206F\uFE00-\uFE0F\uFEFF\uFFF0-\uFFF8]/gu;

    function normalize(raw, options = {}) {
      const trimmed = raw.trim();
      const nfkc = (options.unicode ?? true) ? trimmed.normalize("NFKC") : trimmed;
      return nfkc.toLowerCase().replace(/^@+/, "");
    }

    function applyDemoProfanityWords(payload) {
      demoProfanityWords = uniqueNonEmptyStrings(
        payload.map((word) => normalize(String(word)))
      );
      profanityWordCount = demoProfanityWords.length;
    }

    async function loadDemoProfanityWords() {
      const preloaded = globalThis[DEMO_PROFANITY_GLOBAL_KEY];
      if (Array.isArray(preloaded) && preloaded.length > 0) {
        applyDemoProfanityWords(preloaded);
        return;
      }
      try {
        const response = await fetch(DEMO_PROFANITY_WORDS_URL, { cache: "no-store" });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const payload = await response.json();
        if (!Array.isArray(payload)) throw new Error("Expected an array of words.");

        applyDemoProfanityWords(payload);
      } catch (error) {
        console.warn("Could not load playground profanity list.", error);
        demoProfanityWords = [];
        profanityWordCount = 0;
      }
    }

    function buildReservedMap(reserved) {
      const map = new Map();
      if (!reserved) return map;
      if (reserved instanceof Set) {
        for (const name of reserved) map.set(name, "default");
      } else if (Array.isArray(reserved)) {
        for (const name of reserved) map.set(name, "default");
      } else {
        for (const [category, names] of Object.entries(reserved)) {
          for (const name of names) map.set(name, category);
        }
      }
      return map;
    }

    function clamp(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    function uniqueNonEmptyStrings(values) {
      const seen = new Set();
      const result = [];
      for (const value of values) {
        if (!value) continue;
        if (seen.has(value)) continue;
        seen.add(value);
        result.push(value);
      }
      return result;
    }

    function hasMixedScripts(value) {
      return /[a-z]/i.test(value) && NON_LATIN_RE.test(value);
    }

    function countDefaultIgnorables(value) {
      DEFAULT_IGNORABLE_RE.lastIndex = 0;
      const matches = value.match(DEFAULT_IGNORABLE_RE);
      return matches ? matches.length : 0;
    }

    function countConfusableChars(value, map) {
      let confusableCount = 0;
      let divergenceCount = 0;
      for (const ch of value) {
        if (map[ch]) {
          confusableCount += 1;
          if (ch.normalize("NFKC").toLowerCase() !== map[ch]) divergenceCount += 1;
        }
      }
      return { confusableCount, divergenceCount };
    }

    function skeleton(value, map) {
      let output = "";
      const normalized = normalize(value);
      for (const ch of normalized) output += map[ch] ?? ch;
      return output;
    }

    function levenshteinDistance(a, b) {
      if (a === b) return 0;
      if (!a.length) return b.length;
      if (!b.length) return a.length;
      const prev = Array.from({ length: b.length + 1 }, (_, i) => i);
      const curr = new Array(b.length + 1).fill(0);
      for (let i = 1; i <= a.length; i++) {
        curr[0] = i;
        for (let j = 1; j <= b.length; j++) {
          const cost = a[i - 1] === b[j - 1] ? 0 : 1;
          curr[j] = Math.min(
            prev[j] + 1,
            curr[j - 1] + 1,
            prev[j - 1] + cost
          );
        }
        for (let j = 0; j <= b.length; j++) prev[j] = curr[j];
      }
      return prev[b.length];
    }

    function scoreSimilarityRisk(identifier, target, map) {
      const idSkeleton = skeleton(identifier, map);
      const targetSkeleton = skeleton(target, map);
      const distance = levenshteinDistance(idSkeleton, targetSkeleton);
      const maxLen = Math.max(idSkeleton.length, targetSkeleton.length, 1);
      const similarity = 1 - distance / maxLen;
      let score = Math.round(similarity * 78);
      const skeletonEqual = idSkeleton === targetSkeleton;
      if (skeletonEqual) score = Math.max(score, 92);
      if (distance === 1) score += 12;
      else if (distance === 2) score += 6;
      const chainDepth = distance;
      if (chainDepth >= 2) score += Math.min(8, chainDepth * 2);
      return {
        score: clamp(score, 0, 100),
        distance,
        chainDepth,
        skeletonEqual,
      };
    }

    function levelForScore(score, warnThreshold, blockThreshold) {
      if (score >= blockThreshold) return "high";
      if (score >= warnThreshold) return "medium";
      return "low";
    }

    function actionForScore(score, warnThreshold, blockThreshold) {
      if (score >= blockThreshold) return "block";
      if (score >= warnThreshold) return "warn";
      return "allow";
    }

    // Strategy factories
    function extractMaxLength(pattern) {
      const src = pattern.source;
      const m = src.match(/\{(\d+),(\d+)\}/);
      if (m) return parseInt(m[2], 10) + 1;
      return null;
    }

    function createSequentialStrategy(pattern) {
      const maxLen = extractMaxLength(pattern);
      return (identifier) => {
        const candidates = [];
        for (let i = 1; i <= 9; i++) {
          const hyphenated = `${identifier}-${i}`;
          const compact = `${identifier}${i}`;
          if (!maxLen || hyphenated.length <= maxLen) candidates.push(hyphenated);
          if (!maxLen || compact.length <= maxLen) candidates.push(compact);
        }
        return candidates;
      };
    }

    function createRandomDigitsStrategy(pattern) {
      const maxLen = extractMaxLength(pattern);
      return (identifier) => {
        const candidates = [];
        for (let i = 0; i < 15; i++) {
          const digits = String(Math.floor(100 + Math.random() * 9900));
          const candidate = `${identifier}-${digits}`;
          if ((!maxLen || candidate.length <= maxLen) && pattern.test(candidate)) {
            candidates.push(candidate);
          }
        }
        return candidates;
      };
    }

    function createSuffixWordsStrategy(pattern) {
      const maxLen = extractMaxLength(pattern);
      return (identifier) => {
        return SUFFIX_WORDS
          .map(word => `${identifier}-${word}`)
          .filter(c => (!maxLen || c.length <= maxLen) && pattern.test(c));
      };
    }

    function createShortRandomStrategy(pattern) {
      const maxLen = extractMaxLength(pattern);
      const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
      return (identifier) => {
        const candidates = [];
        for (let i = 0; i < 10; i++) {
          let suffix = "";
          for (let j = 0; j < 3; j++) suffix += chars[Math.floor(Math.random() * chars.length)];
          const candidate = `${identifier}-${suffix}`;
          if ((!maxLen || candidate.length <= maxLen) && pattern.test(candidate)) {
            candidates.push(candidate);
          }
        }
        return candidates;
      };
    }

    function createScrambleStrategy(pattern) {
      return (identifier) => {
        const seen = new Set();
        const candidates = [];
        const chars = identifier.split("");
        for (let i = 0; i < chars.length - 1; i++) {
          if (chars[i] === chars[i + 1]) continue;
          const swapped = [...chars];
          [swapped[i], swapped[i + 1]] = [swapped[i + 1], swapped[i]];
          const candidate = swapped.join("");
          if (!seen.has(candidate) && candidate !== identifier && pattern.test(candidate)) {
            seen.add(candidate);
            candidates.push(candidate);
          }
        }
        return candidates;
      };
    }

    function createSimilarStrategy(pattern) {
      const maxLen = extractMaxLength(pattern) ?? 30;
      const nearby = {
        a: "sqwz", b: "vngh", c: "xdfv", d: "sfce", e: "wrd", f: "dgcv",
        g: "fhtb", h: "gjyn", i: "uko", j: "hknm", k: "jli", l: "kop",
        m: "njk", n: "bmhj", o: "ipl", p: "ol", q: "wa", r: "eft",
        s: "adwz", t: "rgy", u: "yij", v: "cfgb", w: "qase", x: "zsdc",
        y: "tuh", z: "xas",
        "0": "19", "1": "02", "2": "13", "3": "24", "4": "35",
        "5": "46", "6": "57", "7": "68", "8": "79", "9": "80",
      };
      const prefixes = ["the", "my", "x", "i"];
      const suffixes = ["x", "o", "i", "z"];
      return (identifier) => {
        const seen = new Set();
        const candidates = [];
        function add(c) {
          if (c.length >= 2 && c.length <= maxLen && c !== identifier && pattern.test(c) && !seen.has(c)) {
            seen.add(c);
            candidates.push(c);
          }
        }
        for (let i = 0; i < identifier.length; i++) {
          add(identifier.slice(0, i) + identifier.slice(i + 1));
        }
        for (let i = 0; i < identifier.length; i++) {
          const ch = identifier[i];
          const neighbours = nearby[ch] ?? "";
          for (const n of neighbours) {
            add(identifier.slice(0, i) + n + identifier.slice(i + 1));
          }
        }
        for (const p of prefixes) add(p + identifier);
        for (const s of suffixes) add(identifier + s);
        return candidates;
      };
    }

    function createStrategy(name, pattern) {
      switch (name) {
        case "sequential": return createSequentialStrategy(pattern);
        case "random-digits": return createRandomDigitsStrategy(pattern);
        case "suffix-words": return createSuffixWordsStrategy(pattern);
        case "short-random": return createShortRandomStrategy(pattern);
        case "scramble": return createScrambleStrategy(pattern);
        case "similar": return createSimilarStrategy(pattern);
        default: return createSequentialStrategy(pattern);
      }
    }

    function resolveGenerator(suggest, pattern) {
      if (suggest?.generate) return suggest.generate;
      const strategyInput = suggest?.strategy ?? ["sequential", "random-digits"];
      if (typeof strategyInput === "function") return strategyInput;
      const names = Array.isArray(strategyInput) ? strategyInput : [strategyInput];
      const generators = names.map(name => createStrategy(name, pattern));
      return (identifier) => {
        const lists = generators.map(g => g(identifier));
        const result = [];
        const maxLen = Math.max(...lists.map(l => l.length));
        for (let i = 0; i < maxLen; i++) {
          for (const list of lists) {
            if (i < list.length) result.push(list[i]);
          }
        }
        return result;
      };
    }

    function createNamespaceGuard(config, adapter) {
      const pattern = config.pattern ?? DEFAULT_PATTERN;
      const normalizeUnicode = config.normalizeUnicode ?? true;
      const normalizeInput = (value) => normalize(value, { unicode: normalizeUnicode });
      const configMessages = config.messages ?? {};
      const defaultReservedMsg = DEFAULT_MESSAGES.reserved;
      const invalidMsg = configMessages.invalid ?? DEFAULT_MESSAGES.invalid;
      const takenMsg = configMessages.taken ?? DEFAULT_MESSAGES.taken;
      const validators = config.validators ?? [];
      const allowPurelyNumeric = config.allowPurelyNumeric ?? true;
      const purelyNumericMsg = configMessages.purelyNumeric ?? DEFAULT_MESSAGES.purelyNumeric;
      const riskConfig = {
        includeReserved: true,
        protect: [],
        maxMatches: 3,
        warnThreshold: 45,
        blockThreshold: 70,
        ...(config.risk ?? {}),
      };

      const rawReservedMap = buildReservedMap(config.reserved);
      const reservedMap = new Map();
      for (const [name, category] of rawReservedMap.entries()) {
        reservedMap.set(normalizeInput(name), category);
      }

      function getReservedMessage(category) {
        const rm = configMessages.reserved;
        if (typeof rm === "string") return rm;
        if (rm && typeof rm === "object") return rm[category] ?? defaultReservedMsg;
        return defaultReservedMsg;
      }

      function validateFormat(identifier) {
        const normalized = normalizeInput(identifier);
        if (!pattern.test(normalized)) return invalidMsg;
        if (!allowPurelyNumeric && /^\d+(-\d+)*$/.test(normalized)) return purelyNumericMsg;
        if (reservedMap.has(normalized)) return getReservedMessage(reservedMap.get(normalized));
        return null;
      }

      async function checkDbOnly(value, scope) {
        const checks = config.sources.map(async (source) => {
          const existing = await adapter.findOne(source, value);
          if (!existing) return null;
          if (source.scopeKey) {
            const scopeValue = scope[source.scopeKey];
            const idColumn = source.idColumn ?? "id";
            const existingId = existing[idColumn];
            if (scopeValue && existingId && scopeValue === String(existingId)) return null;
          }
          return source.name;
        });
        const results = await Promise.all(checks);
        return !results.some((r) => r !== null);
      }

      async function check(identifier, scope = {}, options) {
        const normalized = normalizeInput(identifier);
        if (!pattern.test(normalized)) {
          return { available: false, reason: "invalid", message: invalidMsg };
        }
        if (!allowPurelyNumeric && /^\d+(-\d+)*$/.test(normalized)) {
          return { available: false, reason: "invalid", message: purelyNumericMsg };
        }

        const reservedCategory = reservedMap.get(normalized);
        if (reservedCategory) {
          return {
            available: false,
            reason: "reserved",
            message: getReservedMessage(reservedCategory),
            category: reservedCategory,
          };
        }

        for (const validator of validators) {
          const rejection = await validator(normalized);
          if (rejection) {
            return { ...rejection, reason: "invalid", message: rejection.message };
          }
        }

        const dbChecks = config.sources.map(async (source) => {
          const existing = await adapter.findOne(source, normalized);
          if (!existing) return null;
          if (source.scopeKey) {
            const scopeValue = scope[source.scopeKey];
            const idColumn = source.idColumn ?? "id";
            const existingId = existing[idColumn];
            if (scopeValue && existingId && scopeValue === String(existingId)) return null;
          }
          return source.name;
        });
        const results = await Promise.all(dbChecks);
        const collision = results.find((r) => r !== null);
        if (collision) {
          const result = {
            available: false,
            reason: "taken",
            message: takenMsg(collision),
            source: collision,
          };
          if (config.suggest && !options?.skipSuggestions) {
            const generate = resolveGenerator(config.suggest, pattern);
            const max = config.suggest.max ?? 3;
            const candidates = generate(normalized);
            const suggestions = [];
            const passedSync = candidates.filter(
              (c) =>
                pattern.test(c) &&
                !reservedMap.has(c) &&
                (allowPurelyNumeric || !/^\d+(-\d+)*$/.test(c))
            );
            for (const candidate of passedSync) {
              if (suggestions.length >= max) break;
              if (await checkDbOnly(candidate, scope)) suggestions.push(candidate);
            }
            if (suggestions.length > 0) result.suggestions = suggestions;
          }
          return result;
        }

        return { available: true };
      }

      async function assertAvailable(identifier, scope = {}) {
        const result = await check(identifier, scope);
        if (!result.available) throw new Error(result.message);
      }

      function checkRisk(identifier, options = {}) {
        const normalized = normalizeInput(identifier);
        const map = options.map ?? CONFUSABLE_MAP;
        const includeReserved = options.includeReserved ?? riskConfig.includeReserved ?? true;
        const maxMatches = Math.max(1, options.maxMatches ?? riskConfig.maxMatches ?? 3);

        const warnThreshold = clamp(
          Math.round(options.warnThreshold ?? riskConfig.warnThreshold ?? 45),
          0,
          100
        );
        const requestedBlock = clamp(
          Math.round(options.blockThreshold ?? riskConfig.blockThreshold ?? 70),
          0,
          100
        );
        const blockThreshold =
          requestedBlock <= warnThreshold ? Math.min(100, warnThreshold + 1) : requestedBlock;

        const reasons = [];
        let heuristicScore = 0;
        function addReason(code, message, weight) {
          const safeWeight = clamp(Math.round(weight), 0, 100);
          reasons.push({ code, message, weight: safeWeight });
          heuristicScore += safeWeight;
        }

        if (hasMixedScripts(normalized)) {
          addReason("mixed-script", "Identifier mixes Latin and non-Latin scripts.", 24);
        }

        const ignorableCount = countDefaultIgnorables(normalized);
        if (ignorableCount > 0) {
          addReason(
            "invisible-character",
            `Identifier contains ${ignorableCount} default-ignorable Unicode character(s).`,
            Math.min(22, 10 + ignorableCount * 4)
          );
        }

        const charStats = countConfusableChars(normalized, map);
        if (charStats.confusableCount > 0) {
          addReason(
            "confusable-character",
            `Identifier contains ${charStats.confusableCount} confusable character(s).`,
            Math.min(24, 8 + charStats.confusableCount * 3)
          );
        }

        if (charStats.divergenceCount > 0) {
          addReason(
            "divergent-mapping",
            `Identifier includes ${charStats.divergenceCount} mapping(s) where NFKC and TR39 differ.`,
            Math.min(16, 6 + charStats.divergenceCount * 3)
          );
        }

        const configuredProtect = riskConfig.protect ?? [];
        const explicitProtect = options.protect;
        const protectInputs = explicitProtect ?? configuredProtect;
        const normalizedProtect = uniqueNonEmptyStrings(
          (protectInputs ?? []).map((target) => normalizeInput(target))
        );

        const protectedTargets = new Set();
        if (includeReserved) {
          for (const reservedName of reservedMap.keys()) protectedTargets.add(reservedName);
        }
        for (const target of normalizedProtect) protectedTargets.add(target);

        const scoredMatches = [];
        for (const target of protectedTargets) {
          if (!target || target === normalized) {
            if (target === normalized) {
              scoredMatches.push({
                target,
                score: 100,
                distance: 0,
                chainDepth: 0,
                skeletonEqual: true,
                reasons: ["Exact protected target match"],
              });
            }
            continue;
          }

          const distance = scoreSimilarityRisk(normalized, target, map);
          if (distance.score < 35) continue;

          const matchReasons = [];
          if (distance.skeletonEqual) matchReasons.push("TR39 skeleton collision");
          if (distance.chainDepth >= 2) matchReasons.push(`chain depth ${distance.chainDepth}`);

          scoredMatches.push({
            target,
            score: distance.score,
            distance: distance.distance,
            chainDepth: distance.chainDepth,
            skeletonEqual: distance.skeletonEqual,
            reasons: matchReasons,
          });
        }

        scoredMatches.sort((a, b) => {
          if (b.score !== a.score) return b.score - a.score;
          if (a.distance !== b.distance) return a.distance - b.distance;
          return a.target.localeCompare(b.target);
        });

        const matches = scoredMatches.slice(0, maxMatches);
        let score = clamp(heuristicScore, 0, 100);
        if (matches.length > 0) {
          const top = matches[0];
          score = Math.max(score, top.score);
          addReason(
            "confusable-target",
            `Identifier is visually close to protected target "${top.target}".`,
            top.score
          );
          if (top.skeletonEqual) {
            addReason("skeleton-collision", `Identifier skeleton collides with "${top.target}".`, 20);
          }
          if (top.chainDepth >= 2) {
            addReason(
              "deep-chain",
              `Confusable transformation chain depth is ${top.chainDepth}.`,
              Math.min(16, 6 + top.chainDepth * 2)
            );
          }
        }

        score = clamp(Math.max(score, heuristicScore), 0, 100);
        reasons.sort((a, b) => b.weight - a.weight);

        return {
          identifier,
          normalized,
          score,
          level: levelForScore(score, warnThreshold, blockThreshold),
          action: actionForScore(score, warnThreshold, blockThreshold),
          reasons,
          matches,
        };
      }

      function enforceRisk(identifier, options = {}) {
        const {
          failOn,
          messages,
          protect,
          includeReserved,
          map,
          maxMatches,
          warnThreshold,
          blockThreshold,
        } = options;
        const configuredProtect = riskConfig.protect ?? [];
        const fallbackProtect =
          configuredProtect.length > 0 ? configuredProtect : DEFAULT_PROTECTED_TOKENS;
        const effectiveProtect = protect ?? fallbackProtect;

        const risk = checkRisk(identifier, {
          protect: effectiveProtect,
          includeReserved,
          map,
          maxMatches,
          warnThreshold,
          blockThreshold,
        });
        const failMode = failOn ?? "block";
        const deny = failMode === "warn" ? risk.action !== "allow" : risk.action === "block";

        if (!deny) return { allowed: true, action: risk.action, risk };

        const topTarget = risk.matches[0]?.target;
        const suffix = topTarget ? ` Closest protected target: "${topTarget}".` : "";
        const defaultWarnMessage =
          "Identifier is potentially confusable with a protected name." + suffix;
        const defaultBlockMessage = "Identifier is too confusable with a protected name." + suffix;

        return {
          allowed: false,
          action: risk.action,
          message: risk.action === "block"
            ? messages?.block ?? defaultBlockMessage
            : messages?.warn ?? defaultWarnMessage,
          risk,
        };
      }

      async function assertClaimable(identifier, scope = {}, options) {
        const availability = await check(identifier, scope, { skipSuggestions: true });
        if (!availability.available) throw new Error(availability.message);

        const decision = enforceRisk(identifier, options);
        if (!decision.allowed) {
          throw new Error(
            decision.message ?? "Identifier is too close to a protected or existing namespace."
          );
        }
      }

      return {
        normalize: normalizeInput,
        validateFormat,
        check,
        assertAvailable,
        checkRisk,
        enforceRisk,
        assertClaimable,
      };
    }

    function createNamespaceGuardWithProfile(profileName, config = {}, adapter) {
      const profile = NAMESPACE_PROFILES[profileName];
      if (!profile) throw new Error(`Unknown namespace profile: ${profileName}`);
      return createNamespaceGuard(
        {
          ...config,
          pattern: config.pattern ?? profile.pattern,
          normalizeUnicode: config.normalizeUnicode ?? profile.normalizeUnicode,
          allowPurelyNumeric: config.allowPurelyNumeric ?? profile.allowPurelyNumeric,
          risk: {
            ...profile.risk,
            ...(config.risk ?? {}),
          },
        },
        adapter
      );
    }

    // === Mock adapter ===
    const mockDatabase = {
      user: {
        "sarah":   { id: "u1", handle: "sarah" },
        "bob":     { id: "u2", handle: "bob" },
        "charlie": { id: "u3", handle: "charlie" },
      },
      organization: {
        "acme-corp": { id: "o1", slug: "acme-corp" },
        "github":    { id: "o2", slug: "github" },
        "vercel":    { id: "o3", slug: "vercel" },
      },
    };

    const playgroundAdapter = {
      async findOne(source, value) {
        const table = mockDatabase[source.name];
        if (!table) return null;
        return table[value] ?? null;
      },
    };

    // === Guard factory (recreated when strategy/options change) ===
    let currentProfile = "consumer-handle";
    let currentStrategy = ["sequential", "random-digits"];
    let homoglyphEnabled = true;
    let mixedScriptEnabled = true;
    let profanityEnabled = true;
    let rejectNumeric = true;
    let failOnWarn = false;

    function createGuard(strategy) {
      const validators = [];
      if (homoglyphEnabled || mixedScriptEnabled) {
        validators.push(
          createHomoglyphValidator({
            checkConfusables: homoglyphEnabled,
            rejectMixedScript: mixedScriptEnabled,
          })
        );
      }
      if (profanityEnabled && demoProfanityWords.length > 0) {
        validators.push(
          createProfanityValidator(demoProfanityWords, {
            mode: "evasion",
            variantProfile: "balanced",
            minSubstringLength: 4,
            message: "That handle is blocked by moderation policy.",
          })
        );
      }
      const profile = NAMESPACE_PROFILES[currentProfile];
      const allowPurelyNumeric = rejectNumeric
        ? false
        : (profile?.allowPurelyNumeric ?? false);
      return createNamespaceGuardWithProfile(
        currentProfile,
        {
          reserved: {
            system: ["admin", "api", "settings", "dashboard", "login", "signup", "help", "support", "billing"],
            brand:  ["namespace-guard"],
          },
          sources: [
            { name: "user", column: "handle", scopeKey: "id" },
            { name: "organization", column: "slug", scopeKey: "id" },
          ],
          messages: {
            reserved: {
              system: "That\u2019s a reserved system route.",
              brand:  "That\u2019s a protected brand name.",
            },
            taken: (source) => `Already taken by a ${source}.`,
          },
          suggest: {
            strategy,
            max: 3,
          },
          risk: {
            protect: ["paypal", "github", "vercel", "namespace-guard", "support", "admin"],
          },
          validators,
          allowPurelyNumeric,
        },
        playgroundAdapter
      );
    }

    let guard = createGuard(currentStrategy);

    // === Playground logic ===
    const form = document.getElementById("check-form");
    const input = document.getElementById("slug-input");
    const resultEl = document.getElementById("result");
    const copyBtn = document.getElementById("copy-btn");
    const policySummaryEl = document.getElementById("playground-policy");
    const policyDepthEl = document.getElementById("playground-depth");

    function updatePolicySummary() {
      const checks = [
        "format",
        "reserved names",
        "DB collisions",
      ];
      if (homoglyphEnabled) checks.push("confusable chars");
      if (mixedScriptEnabled) checks.push("mixed-script block");
      if (profanityEnabled) {
        if (profanityWordCount > 0) {
          checks.push(`profanity evasion (${profanityWordCount.toLocaleString()} words)`);
        } else {
          checks.push("profanity evasion (list loading)");
        }
      }
      const riskMode = failOnWarn ? "warn + block" : "block only";
      const numericMode = rejectNumeric
        ? "purely numeric blocked"
        : (NAMESPACE_PROFILES[currentProfile]?.allowPurelyNumeric ? "purely numeric allowed" : "purely numeric blocked by profile");
      policySummaryEl.textContent = `Active policy (${currentProfile}): ${checks.join(", ")}. Risk gate: ${riskMode}. Numeric rule: ${numericMode}.`;
      if (policyDepthEl) {
        policyDepthEl.textContent = profanityWordCount > 0
          ? `Curated default profanity list depth: ${profanityWordCount.toLocaleString()} terms.`
          : "Curated default profanity list depth: loading.";
      }
    }

    function escapeHtml(str) {
      const div = document.createElement("div");
      div.textContent = str;
      return div.innerHTML;
    }

    function debounce(fn, ms) {
      let timer;
      const debounced = (...args) => { clearTimeout(timer); timer = setTimeout(() => fn(...args), ms); };
      debounced.cancel = () => clearTimeout(timer);
      return debounced;
    }

    const iconCheck = `<svg class="result-icon" viewBox="0 0 24 24" fill="none" stroke="#1ed760" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="9 12 11.5 14.5 16 10"/></svg>`;
    const iconX = `<svg class="result-icon" viewBox="0 0 24 24" fill="none" stroke="#ff5a5a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`;
    const iconShield = `<svg class="result-icon" viewBox="0 0 24 24" fill="none" stroke="#ffbe3c" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`;

    // Build an annotated slug display highlighting the offending character
    function annotateSlug(value, spoofChar) {
      if (!spoofChar) return `<span class="slug-name">${escapeHtml(value)}</span>`;
      let html = '<span class="slug-annotated">';
      for (const ch of value) {
        if (ch === spoofChar) {
          html += `<span class="spoof-char">${escapeHtml(ch)}</span>`;
        } else {
          html += escapeHtml(ch);
        }
      }
      html += '</span>';
      return html;
    }

    function renderRiskDetail(risk) {
      const top = risk?.matches?.[0];
      if (!top) return "";
      const reasonText = Array.isArray(top.reasons) && top.reasons.length > 0
        ? `<div class="char-meta">${top.reasons.slice(0, 2).map((reason) => escapeHtml(reason)).join(" • ")}</div>`
        : "";
      return `<div class="confusable-detail">Closest protected target <span class="char-latin">${escapeHtml(top.target)}</span> <span class="char-meta">(risk ${top.score}/100, action ${escapeHtml(risk.action)})</span>${reasonText}</div>`;
    }

    function renderResult(value, result) {
      if (!value) { resultEl.innerHTML = ""; return; }
      const normalized = escapeHtml(normalize(value));

      if (result.available) {
        if (result.risk && result.risk.action === "warn") {
          const message = result.message ?? "Available, but visually close to a protected target.";
          const riskHtml = renderRiskDetail(result.risk);
          resultEl.innerHTML = `<div class="result-card result-riskwarn">${iconShield}<div class="result-body"><strong><span class="slug-name">${normalized}</span></strong><div class="result-msg">${escapeHtml(message)}</div>${riskHtml}</div></div>`;
          return;
        }
        resultEl.innerHTML = `<div class="result-card result-available">${iconCheck}<div class="result-body"><strong><span class="slug-name">${normalized}</span></strong> is claimable.</div></div>`;
        return;
      }

      let icon, cls, extra = "";
      if (result.reason === "reserved") {
        icon = iconShield; cls = "result-reserved";
        if (result.category) extra = `<span class="result-category">${escapeHtml(result.category)}</span>`;
      } else if (result.reason === "taken") {
        icon = iconX; cls = "result-taken";
        if (result.source) extra = `<span class="result-source">${escapeHtml(result.source)}</span>`;
      } else if (result.reason === "risk") {
        icon = iconShield;
        cls = result.action === "block" ? "result-riskblock" : "result-riskwarn";
        const topTarget = result.risk?.matches?.[0]?.target;
        if (topTarget) extra = `<span class="result-category">${escapeHtml(topTarget)}</span>`;
      } else {
        icon = iconX; cls = "result-invalid";
      }

      let suggestionsHtml = "";
      if (result.suggestions && result.suggestions.length > 0) {
        const pills = result.suggestions.map(s => `<button class="suggestion-pill" data-suggestion="${escapeHtml(s)}">${escapeHtml(s)}</button>`).join("");
        suggestionsHtml = `<div class="suggestions"><div class="suggestions-label">Try instead:</div><div class="suggestion-pills">${pills}</div></div>`;
      }

      let confusableHtml = "";
      const spoofChar = result._confusableChar || result._mixedScriptChar || null;
      if (result._confusableChar) {
        const ch = result._confusableChar;
        const target = result._confusableTarget;
        const script = result._confusableScript;
        const cp = ch.codePointAt(0);
        const hex = "U+" + cp.toString(16).toUpperCase().padStart(4, "0");
        confusableHtml = `<div class="confusable-detail"><span class="char-highlight">${escapeHtml(ch)}</span> <span class="char-meta">(${script} ${hex})</span> looks like <span class="char-latin">${escapeHtml(target)}</span> <span class="char-meta">(Latin)</span></div>`;
      } else if (result._mixedScriptChar) {
        const ch = result._mixedScriptChar;
        const script = result._mixedScript;
        const cp = ch.codePointAt(0);
        const hex = "U+" + cp.toString(16).toUpperCase().padStart(4, "0");
        confusableHtml = `<div class="confusable-detail">Found <span class="char-highlight">${escapeHtml(ch)}</span> <span class="char-meta">(${script} ${hex})</span> mixed with Latin characters</div>`;
      }

      if (result.reason === "risk" && result.risk) {
        confusableHtml += renderRiskDetail(result.risk);
      }

      const slugDisplay = spoofChar
        ? annotateSlug(value, spoofChar)
        : `<span class="slug-name">${normalized}</span>`;

      resultEl.innerHTML = `<div class="result-card ${cls}">${icon}<div class="result-body"><strong>${slugDisplay}</strong>${extra}<div class="result-msg">${escapeHtml(result.message)}</div>${confusableHtml}${suggestionsHtml}</div></div>`;
    }

    let lastRendered = "";
    async function checkSlug(value) {
      if (!value.trim()) { lastRendered = ""; renderResult("", null); return; }
      const normalized = normalize(value);
      if (normalized === lastRendered) return;

      const availability = await guard.check(value);
      if (!availability.available) {
        lastRendered = normalized;
        renderResult(value, availability);
        return;
      }

      const decision = guard.enforceRisk(value, {
        failOn: failOnWarn ? "warn" : "block",
      });
      lastRendered = normalized;

      if (!decision.allowed) {
        renderResult(value, {
          available: false,
          reason: "risk",
          action: decision.action,
          message: decision.message ?? "Identifier is too confusable with a protected name.",
          risk: decision.risk,
        });
        return;
      }

      if (decision.action === "warn") {
        renderResult(value, {
          available: true,
          message: "Claimable, but close to a protected target.",
          risk: decision.risk,
        });
        return;
      }

      renderResult(value, { available: true });
    }

    const debouncedCheck = debounce(checkSlug, 300);
    input.addEventListener("input", (e) => debouncedCheck(e.target.value));
    form.addEventListener("submit", (e) => { e.preventDefault(); debouncedCheck.cancel(); checkSlug(input.value); });

    // Example pills
    document.querySelectorAll("[data-slug]").forEach(btn => {
      btn.addEventListener("click", () => {
        input.value = btn.dataset.slug;
        lastRendered = "";
        checkSlug(btn.dataset.slug);
        input.focus();
      });
    });

    // Suggestion pills (event delegation)
    resultEl.addEventListener("click", (e) => {
      const pill = e.target.closest("[data-suggestion]");
      if (pill) {
        input.value = pill.dataset.suggestion;
        lastRendered = "";
        checkSlug(pill.dataset.suggestion);
        input.focus();
      }
    });

    // Adapter tabs
    const tabList = document.querySelector("[role=tablist]");
    const tabs = tabList.querySelectorAll("[role=tab]");
    const panels = document.querySelectorAll("[role=tabpanel]");

    function switchTab(tab) {
      tabs.forEach(t => t.setAttribute("aria-selected", "false"));
      panels.forEach(p => p.classList.remove("active"));
      tab.setAttribute("aria-selected", "true");
      document.getElementById(tab.getAttribute("aria-controls")).classList.add("active");
    }

    tabs.forEach(tab => {
      tab.addEventListener("click", () => switchTab(tab));
      tab.addEventListener("keydown", (e) => {
        const idx = Array.from(tabs).indexOf(tab);
        let next;
        if (e.key === "ArrowRight") next = tabs[(idx + 1) % tabs.length];
        else if (e.key === "ArrowLeft") next = tabs[(idx - 1 + tabs.length) % tabs.length];
        else if (e.key === "Home") next = tabs[0];
        else if (e.key === "End") next = tabs[tabs.length - 1];
        if (next) { e.preventDefault(); next.focus(); switchTab(next); }
      });
    });

    // Profile chips
    const profileChips = document.querySelectorAll("[data-profile]");
    profileChips.forEach(chip => {
      chip.addEventListener("click", () => {
        profileChips.forEach(c => c.setAttribute("aria-pressed", "false"));
        chip.setAttribute("aria-pressed", "true");
        currentProfile = chip.dataset.profile;
        refreshGuard();
      });
    });

    // Strategy chips
    const strategyChips = document.querySelectorAll("[data-strategy]");
    strategyChips.forEach(chip => {
      chip.addEventListener("click", () => {
        strategyChips.forEach(c => c.setAttribute("aria-pressed", "false"));
        chip.setAttribute("aria-pressed", "true");
        const raw = chip.dataset.strategy;
        const strategy = raw.includes(",") ? raw.split(",") : raw;
        currentStrategy = strategy;
        guard = createGuard(strategy);
        // Re-check current input with new strategy
        if (input.value.trim()) {
          lastRendered = "";
          checkSlug(input.value);
        }
      });
    });

    // Security toggles
    const toggleHomoglyph = document.getElementById("toggle-homoglyph");
    const toggleMixedScript = document.getElementById("toggle-mixed-script");
    const toggleProfanity = document.getElementById("toggle-profanity");
    const toggleNumeric = document.getElementById("toggle-numeric");
    const toggleFailWarn = document.getElementById("toggle-fail-warn");

    function refreshGuard() {
      guard = createGuard(currentStrategy);
      updatePolicySummary();
      if (input.value.trim()) { lastRendered = ""; checkSlug(input.value); }
    }

    toggleHomoglyph.addEventListener("click", () => {
      homoglyphEnabled = !homoglyphEnabled;
      toggleHomoglyph.setAttribute("aria-pressed", String(homoglyphEnabled));
      refreshGuard();
    });

    toggleMixedScript.addEventListener("click", () => {
      mixedScriptEnabled = !mixedScriptEnabled;
      toggleMixedScript.setAttribute("aria-pressed", String(mixedScriptEnabled));
      refreshGuard();
    });

    toggleProfanity.addEventListener("click", () => {
      profanityEnabled = !profanityEnabled;
      toggleProfanity.setAttribute("aria-pressed", String(profanityEnabled));
      refreshGuard();
    });

    toggleNumeric.addEventListener("click", () => {
      rejectNumeric = !rejectNumeric;
      toggleNumeric.setAttribute("aria-pressed", String(rejectNumeric));
      refreshGuard();
    });

    toggleFailWarn.addEventListener("click", () => {
      failOnWarn = !failOnWarn;
      toggleFailWarn.setAttribute("aria-pressed", String(failOnWarn));
      updatePolicySummary();
      if (input.value.trim()) { lastRendered = ""; checkSlug(input.value); }
    });

    updatePolicySummary();
    loadDemoProfanityWords().then(() => refreshGuard());

    // Copy button
    copyBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText("npm install namespace-guard");
        copyBtn.textContent = "Copied!";
        setTimeout(() => { copyBtn.textContent = "Copy"; }, 1500);
      } catch {
        copyBtn.textContent = "Failed";
        setTimeout(() => { copyBtn.textContent = "Copy"; }, 1500);
      }
    });
  </script>
</body>
</html>
